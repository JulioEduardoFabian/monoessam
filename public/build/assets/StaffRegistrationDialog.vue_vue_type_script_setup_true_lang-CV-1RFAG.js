import{_ as F}from"./index-fwU1dqK6.js";import{_ as z,a as M,b as O,c as L}from"./DialogTitle.vue_vue_type_script_setup_true_lang-uQpl9zJL.js";import{_ as G}from"./DialogDescription.vue_vue_type_script_setup_true_lang-B8iL-asm.js";import{_ as Z}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bg3NpeNY.js";import{_ as W}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-hjLHk7kX.js";import{c as X,_ as H,a as w,b as I}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BaGKhUDi.js";import{_ as J}from"./AlertErrors.vue_vue_type_script_setup_true_lang-BaKlPg4O.js";import{j as m,C as K,d as Q,g as S,o as U,w as s,a as l,u as e,e as g,b as D,i as Y}from"./app-C3CmS5K9.js";import{_ as q}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-BhFj-ext.js";import{_ as ee}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-DUqr5fx9.js";import{_ as ae}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-DMpCdxny.js";import{_ as le}from"./SizesTab.vue_vue_type_script_setup_true_lang-DXOGnjFu.js";const te=9*1024*1024;function oe(){const t=m(!1),u=m(""),o=m([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:o,showAlert:t,alertMessage:u,handleFileUpload:(_,d,C)=>{const p=_.target.files;if(p.length>0){const b=p[0];if(b.size>te)u.value="El archivo es demasiado grande. El máximo es 9MB.",t.value=!0;else{const n=o.value.find(i=>i.label==d);if(n){const f=b.name.split(".").pop(),c=new File([b],`${d}_${Date.now()}.${f}`,{type:b.type});C.push({file:c,label:d}),n.file=c}}}},handleDateFile:(_,d)=>{o.value[d].expirationDate=_}}}function se(){const t=m(null),u=m(null),o=m(null);return{fileInput:t,imagePreview:u,selectedFile:o,triggerFileInput:()=>{var d;(d=t.value)==null||d.click()},handleImageUpload:d=>{var b;const p=(b=d.target.files)==null?void 0:b[0];if(p){if(!p.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const n=5*1024*1024;if(p.size>n){alert("La imagen es demasiado grande. Máximo 5MB");return}o.value=p;const i=new FileReader;i.onload=f=>{var c;u.value=(c=f.target)==null?void 0:c.result},i.readAsDataURL(p)}},removeImage:()=>{u.value=null,o.value=null,t.value&&(t.value.value="")}}}function ne(){const t=K({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",fechaIngreso:"",fechaFinContract:"",cc:"",cci:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),u=m([]),o=m(!1),x=m([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),h=m([]);return{form:t,errorsSend:u,showErrors:o,prendasFijas:x,cafesUnitSelected:h,handleSubmit:(n,i)=>{let f;Array.isArray(i)?f=i:i&&typeof i=="object"?f=Array.isArray(i.value)?i.value:Object.values(i):f=[],f.forEach(r=>{r&&r.expirationDate===null?t.filesData.push({expirationDate:"-"}):t.filesData.push({expirationDate:r.expirationDate})}),console.log("filesArray:",f);const c=f.filter(r=>r&&typeof r=="object").map(r=>r.file).filter(r=>r instanceof File);if(console.log("Archivos válidos a subir:",c.length,c),c.length===0){console.error("No hay archivos válidos para subir"),o.value=!0,u.value={files:["No hay archivos seleccionados"]};return}t.prendas=x.value,t.files=c,t.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:r=>{t.reset(),n()},onError:r=>{o.value=!0,u.value=r,console.error("Error al subir el archivo:",r)}})},selectCafe:n=>{t.cafeId=n.id},selectRole:n=>{t.roleId=n.id},selectUnit:n=>{t.unitId=n.id,h.value=n.cafes,t.unitSelectedText=n.name},selectArea:n=>{t.areaId=n}}}const re={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},he=Q({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{}},setup(t){const u=m(!1),o=m("personal"),{form:x,errorsSend:h,showErrors:_,prendasFijas:d,cafesUnitSelected:C,handleSubmit:p,selectCafe:b,selectRole:n,selectUnit:i,selectArea:f}=ne(),{fileInput:c,imagePreview:r,triggerFileInput:E,handleImageUpload:$,removeImage:k}=se(),{filesRequired:A,showAlert:R,alertMessage:T,handleFileUpload:j,handleDateFile:N}=oe(),B=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a<v.length-1&&(o.value=v[a+1])},P=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a>0&&(o.value=v[a-1])},V=()=>{p(()=>{u.value=!1,o.value="personal"},A)};return(v,a)=>(U(),S(e(L),{open:u.value,"onUpdate:open":a[2]||(a[2]=y=>u.value=y)},{default:s(()=>[l(e(W),{"as-child":""},{default:s(()=>[l(e(F),{variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[3]||(a[3]=[g(" Nuevo Personal ")])),_:1})]),_:1}),l(e(z),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:s(()=>[D("input",{type:"file",ref_key:"fileInput",ref:c,onChange:a[0]||(a[0]=(...y)=>e($)&&e($)(...y)),accept:"image/*",class:"hidden"},null,544),l(e(M),{class:"z-10 border-b bg-white px-6 py-4"},{default:s(()=>[l(e(O),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:s(()=>a[4]||(a[4]=[g(" Ficha de Registro de Colaborador ")])),_:1}),l(e(G),null,{default:s(()=>a[5]||(a[5]=[g(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),l(J,{show:e(_),errors:e(h)},null,8,["show","errors"])]),_:1}),D("div",re,[l(e(X),{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=y=>o.value=y),class:"w-full"},{default:s(()=>[l(e(H),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:s(()=>[l(e(w),{value:"personal",class:"text-xs md:text-sm"},{default:s(()=>a[6]||(a[6]=[g("1. Personal")])),_:1}),l(e(w),{value:"adjuntos",class:"text-xs md:text-sm"},{default:s(()=>a[7]||(a[7]=[g("2. Adjuntos")])),_:1}),l(e(w),{value:"financiero",class:"text-xs md:text-sm"},{default:s(()=>a[8]||(a[8]=[g("3. Financiero")])),_:1}),l(e(w),{value:"tallas",class:"text-xs md:text-sm"},{default:s(()=>a[9]||(a[9]=[g("4. Tallas")])),_:1})]),_:1}),l(e(I),{value:"personal",class:"mt-0"},{default:s(()=>[l(ae,{form:e(x),cafes:e(C),units:v.units,roles:v.roles,businneses:v.businneses,"image-preview":e(r),onTriggerUpload:e(E),onRemoveImage:e(k),onSelectCafe:e(b),onSelectUnit:e(i),onSelectRole:e(n),onSelectArea:e(f)},null,8,["form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),l(e(I),{value:"adjuntos",class:"mt-0"},{default:s(()=>[l(q,{"files-required":e(A),"show-alert":e(R),"alert-message":e(T),form:e(x),onUploadFile:e(j),onUploadDate:e(N)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),l(e(I),{value:"financiero",class:"mt-0"},{default:s(()=>[l(ee,{form:e(x),roles:v.roles,onSelectRole:e(n),onUploadFile:e(j)},null,8,["form","roles","onSelectRole","onUploadFile"])]),_:1}),l(e(I),{value:"tallas",class:"mt-0"},{default:s(()=>[l(le,{prendas:e(d)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),l(e(Z),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:s(()=>[D("div",null,[o.value!=="personal"?(U(),S(e(F),{key:0,onClick:P,variant:"outline",type:"button"},{default:s(()=>a[10]||(a[10]=[g(" ← Anterior ")])),_:1})):Y("",!0)]),D("div",null,[o.value!=="tallas"?(U(),S(e(F),{key:0,onClick:B,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[11]||(a[11]=[g(" Siguiente → ")])),_:1})):(U(),S(e(F),{key:1,onClick:V,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:s(()=>a[12]||(a[12]=[g(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{he as _};
