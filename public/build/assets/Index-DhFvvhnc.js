import{_ as E}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfU-JBrE.js";import{d as R,k as a,n as T,c as J,o as C,a as o,u as x,m as j,w as z,b as v,g as G,i as K,F as L,s as M}from"./app-BgIJSUNM.js";import{_ as Q}from"./SubdealershipsDialog.vue_vue_type_script_setup_true_lang-BlV8cNmQ.js";import{_ as W}from"./Alert.vue_vue_type_script_setup_true_lang-ypZ3N79N.js";import{_ as X}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-C9DU2Zma.js";import{_ as Y}from"./SalesCard.vue_vue_type_script_setup_true_lang-BPCYCVpB.js";import{_ as Z}from"./SalesHeader.vue_vue_type_script_setup_true_lang-DgK-mxtv.js";import{_ as ee}from"./SalesTable.vue_vue_type_script_setup_true_lang-jITo7H4c.js";import"./utils-bRKmu4jq.js";import"./index-rzOCJuLp.js";import"./useForwardPropsEmits-WjV4QmOm.js";import"./Primitive-DgJAe62j.js";import"./useForwardExpose-_o8b-5uY.js";import"./useFocusGuards-Dyww5GmN.js";import"./Teleport-Cyedihfc.js";import"./VisuallyHidden-DnB1uBGo.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CYsF0Z_2.js";import"./Collection-wCRpbbxK.js";import"./usePrimitiveElement-Dmv3pMdq.js";import"./utils-Dt-DHGCn.js";import"./useTypeahead-iZnWuDQo.js";import"./RovingFocusGroup-sPSgt6A-.js";import"./createLucideIcon-CRVh3BQS.js";import"./x-D9hIcca1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-DredMPQK.js";import"./user-BHckULM9.js";import"./chevron-right-CcDLkGGb.js";import"./index-6_aBOi8O.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BUblnD0c.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-r3RlsrMH.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-CAvEAjHI.js";import"./Input.vue_vue_type_script_setup_true_lang-BCNxlJCi.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BZe5hrNT.js";import"./chevron-down-BQxTs2Sg.js";import"./check-CqzztHFN.js";import"./nullish-CHIgUVhi.js";import"./circle-plus-Bgh_Aheu.js";import"./Card.vue_vue_type_script_setup_true_lang-CP8nJq7N.js";import"./building-xeJzIk48.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-rzniU0Tj.js";import"./RovingFocusItem-CzUyF6cd.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-C7hy8VTV.js";import"./chevron-left-DCpJMf54.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-B69ZSMkj.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-oc9oCqH2.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-D0dJ-F6U.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-DdJ_us1e.js";import"./NewDinnerDialog.vue_vue_type_script_setup_true_lang-BlQQ6bDI.js";import"./user-plus-BLnZ6D8t.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-CORbZ9l8.js";import"./loader-circle-BsVgy6u6.js";import"./coffee-DG3tMjxn.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-DrX4vlOq.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-BNZtlaPu.js";const te={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ae={class:"grid auto-rows-min gap-4 md:grid-cols-2"},it=R({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},sales:{},subdealerships:{},dealerships:{}},setup(A){const p=a(null),U=T().props.auth.permissions,I=A,r=a([]),$=e=>r.value.some(t=>t.serviceID===e.id),k=e=>{if($(e)){r.value=r.value.filter(t=>t.serviceID!==e.id);return}r.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},P=e=>{N.value=e},f=a([...I.sales]),N=a([]),h=a(!1),_=a(""),S=a(""),l=a(""),d=a(!1),c=a(!1),n=(e,t)=>{var s;_.value=((s=t.response)==null?void 0:s.data.message)||t||"Ha ocurrido un error inesperado.",S.value=e,h.value=!0},u=a(""),y=()=>{d.value=!0},V=()=>{d.value=!1,c.value=!1},B=e=>{l.value=e},H=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else m(e)},g=a(0),D=a(0),w=a(0),O=e=>{g.value=e.cafe_id,D.value=e.sale_type_id,w.value=e.receipt_type_id},q=e=>{c.value=!0,m(u.value)},b=a({}),F=a({}),m=e=>{u.value=e;const t=new FormData;if(t.append("cafe_id",g.value),t.append("sale_type_id",D.value),t.append("receipt_type",w.value),t.append("services",JSON.stringify(r.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",c.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}M.post("./sales",t).then(s=>{var i;s.data.dinner&&(b.value=s.data.dinner,F.value=s.data.dinner.subdealership,n("success",s.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),f.value=s.data.sales||[]),s.data.otherCafe&&(console.log(u.value),y())}).catch(s=>{var i;console.error("Error fetching dinners:",s),n("error",s),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(C(),J(L,null,[o(x(j),{title:"Comensales"}),o(E,null,{default:z(()=>[o(W,{showAlert:h.value,type:S.value,description:_.value},null,8,["showAlert","type","description"]),v("div",te,[t[0]||(t[0]=v("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),x(U).find(s=>s.id==14)?(C(),G(Q,{key:0,dealerships:e.dealerships},null,8,["dealerships"])):K("",!0),o(Z,{cafes:e.cafes,subdealerships:e.subdealerships,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:P,onUpdateDate:B,onUpdateFormData:O,onAddServiceSelected:k},null,8,["cafes","subdealerships","services","receipt_types","sale_types"]),v("div",ae,[o(Y,{dinnerFound:b.value,subdealership:F.value,onHandleShowAlert:n,onShowDialog:y,onSaveSale:m,onUpdateDni:H,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),o(ee,{sales:f.value},null,8,["sales"]),o(X,{showOtherUnitDialog:d.value,onHideDialog:V,onHandleDoublePriceSave:q},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{it as default};
