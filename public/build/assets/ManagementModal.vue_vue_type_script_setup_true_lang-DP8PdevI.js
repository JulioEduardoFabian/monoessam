import{_ as b}from"./index-WSUxmKDE.js";import{_ as D,a as j,b as q,c as z}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Ca97EHnU.js";import{_ as G}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BsgItODS.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-ckNUoNOQ.js";import{_ as H,a as J,b as K,c as O,d as P,e as Q,f as R}from"./SelectValue.vue_vue_type_script_setup_true_lang-CyuH_BuJ.js";import{d as W,l as p,C as X,g as w,o,w as r,a as i,u as a,e as h,b as d,c as u,i as U,F as k,k as y,t as g,s as f}from"./app-DTnkyGMY.js";const Y={class:"mb-4"},Z={class:"flex gap-2"},ee={key:0},ae={key:1},te={key:0,class:"mt-1 max-h-40 overflow-auto rounded-md border"},ne=["onClick"],se={class:"mb-4"},le={class:"flex gap-2"},oe={key:0},ie={key:1},ue={key:0,class:"mt-1 max-h-40 overflow-auto rounded-md border"},re=["onClick"],de={class:"mb-4"},ce={class:"flex gap-2"},me={key:0},fe={key:1},_e={key:0,class:"mt-1 max-h-40 overflow-auto rounded-md border"},pe=["onClick"],xe=W({__name:"ManagementModal",props:{businesses:{}},setup(B){const M=B,_=p([]),c=p([]),m=p([]),F=p(!1),l=p({mine:!1,unit:!1,cafe:!1}),e=X({mine:"",mineId:0,unit:"",unitId:0,cafe:"",cafeId:0,businessId:0}),x=$(()=>{if(e.mine.trim()===""){_.value=[];return}l.value.mine=!0,f.get("/search-mine/"+e.mine).then(s=>{_.value=s.data}).catch(console.error).finally(()=>l.value.mine=!1)},300),I=$(()=>{if(e.unit.trim()===""){c.value=[];return}l.value.unit=!0,f.get("/search-unit/"+e.unit).then(s=>{c.value=s.data}).catch(console.error).finally(()=>l.value.unit=!1)},300),C=$(()=>{if(e.cafe.trim()===""){m.value=[];return}l.value.cafe=!0,f.get("/search-cafe/"+e.cafe).then(s=>{m.value=s.data}).catch(console.error).finally(()=>l.value.cafe=!1)},300),N=()=>{e.mine.trim()!==""&&(l.value.mine=!0,f.post("/mines",{name:e.mine}).then(()=>{e.mineId=0,x()}).catch(console.error).finally(()=>l.value.mine=!1))},L=()=>{e.unit.trim()===""||e.mineId==0||(l.value.unit=!0,f.post("/units",{name:e.unit,mine_id:e.mineId}).then(()=>{e.unitId=0,I()}).catch(console.error).finally(()=>l.value.unit=!1))},T=()=>{e.cafe.trim()===""||e.unitId==0||(l.value.cafe=!0,f.post("/cafes",{name:e.cafe,unit_id:e.unitId,business_id:e.businessId}).then(()=>{e.cafeId=0,C()}).catch(console.error).finally(()=>l.value.cafe=!1))},A=s=>{e.mine=s.name,e.mineId=s.id,_.value=[],c.value=s.units},E=s=>{e.unit=s.name,e.unitId=s.id,c.value=[],m.value=s.cafes,console.log(s)},S=s=>{e.cafe=s.name,e.cafeId=s.id,m.value=[]};function $(s,n){let t;return function(...v){clearTimeout(t),t=setTimeout(()=>s.apply(null,v),n)}}return(s,n)=>(o(),w(a(z),{open:F.value,"onUpdate:open":n[4]||(n[4]=t=>F.value=t)},{default:r(()=>[i(a(G),{"as-child":""},{default:r(()=>[i(b,{variant:"outline"},{default:r(()=>n[5]||(n[5]=[h("Añadir Lugar")])),_:1})]),_:1}),i(a(D),{class:"max-w-md"},{default:r(()=>[i(a(j),null,{default:r(()=>[i(a(q),{class:"mb-4 text-lg font-semibold"},{default:r(()=>n[6]||(n[6]=[h("Agregar Nuevo Lugar")])),_:1}),d("div",Y,[n[7]||(n[7]=d("label",{class:"mb-1 block text-sm font-medium"},"Mina",-1)),d("div",Z,[i(V,{modelValue:a(e).mine,"onUpdate:modelValue":n[0]||(n[0]=t=>a(e).mine=t),type:"text",placeholder:"Buscar mina...",onInput:a(x),onFocus:a(x),class:"flex-1"},null,8,["modelValue","onInput","onFocus"]),i(b,{type:"button",onClick:N,disabled:!a(e).mine.trim()||l.value.mine},{default:r(()=>[l.value.mine?(o(),u("span",ee,"...")):(o(),u("span",ae,"+"))]),_:1},8,["disabled"])]),_.value.length>0?(o(),u("ul",te,[(o(!0),u(k,null,y(_.value,t=>(o(),u("li",{key:t.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:v=>A(t)},g(t.name),9,ne))),128))])):U("",!0)]),d("div",se,[n[8]||(n[8]=d("label",{class:"mb-1 block text-sm font-medium"},"Unidad",-1)),d("div",le,[i(V,{modelValue:a(e).unit,"onUpdate:modelValue":n[1]||(n[1]=t=>a(e).unit=t),type:"text",placeholder:"Buscar unidad...",onInput:a(I),onFocus:a(I),class:"flex-1"},null,8,["modelValue","onInput","onFocus"]),i(b,{type:"button",onClick:L,disabled:!a(e).unit.trim()||l.value.unit},{default:r(()=>[l.value.unit?(o(),u("span",oe,"...")):(o(),u("span",ie,"+"))]),_:1},8,["disabled"])]),c.value.length>0?(o(),u("ul",ue,[(o(!0),u(k,null,y(c.value,t=>(o(),u("li",{key:t.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:v=>E(t)},g(t.name),9,re))),128))])):U("",!0)]),d("div",de,[n[10]||(n[10]=d("label",{class:"mb-1 block text-sm font-medium"},"Cafetería",-1)),d("div",ce,[i(V,{modelValue:a(e).cafe,"onUpdate:modelValue":n[2]||(n[2]=t=>a(e).cafe=t),type:"text",placeholder:"Buscar cafetería...",onInput:a(C),onFocus:a(C),class:"flex-1"},null,8,["modelValue","onInput","onFocus"]),i(a(H),{class:"w-max-[50%]",modelValue:a(e).businessId,"onUpdate:modelValue":n[3]||(n[3]=t=>a(e).businessId=t)},{default:r(()=>[i(a(J),null,{default:r(()=>[i(a(K),{placeholder:"Selecciona una empresa"})]),_:1}),i(a(O),null,{default:r(()=>[i(a(P),null,{default:r(()=>[i(a(Q),null,{default:r(()=>n[9]||(n[9]=[h("Empresas")])),_:1}),(o(!0),u(k,null,y(M.businesses,t=>(o(),w(a(R),{value:t.id,key:t.id},{default:r(()=>[h(g(t.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(b,{type:"button",onClick:T,disabled:!a(e).cafe.trim()||l.value.cafe},{default:r(()=>[l.value.cafe?(o(),u("span",me,"...")):(o(),u("span",fe,"+"))]),_:1},8,["disabled"])]),m.value.length>0?(o(),u("ul",_e,[(o(!0),u(k,null,y(m.value,t=>(o(),u("li",{key:t.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:v=>S(t)},g(t.name),9,pe))),128))])):U("",!0)])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{xe as _};
