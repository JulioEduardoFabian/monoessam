import{b as Z,_ as ee,a as te}from"./index-BMC3KVZO.js";import{_}from"./index-CUg2aZ3x.js";import{_ as ae}from"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-C591jAAc.js";import{_ as se,a as ne,b as oe,c as le}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cz9h-9Sx.js";import{_ as ie}from"./DialogFooter.vue_vue_type_script_setup_true_lang-xXKV7hdh.js";import{_ as re}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-D1djLFSk.js";import{d as ce,l as de,j as g,C as ue,y as pe,g as L,o as r,w as c,a as o,u as i,b as t,e as v,i as b,c as p,t as m,F as P,p as A,n as B}from"./app-BlZoMQ2y.js";import{F as z}from"./file-DUACKjep.js";import{c as F}from"./createLucideIcon-Bam5mdgP.js";import{C as U}from"./calendar-DIxDjMf1.js";import{X as me}from"./x-BxpBCfXk.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=F("DownloadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=F("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=F("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),xe={class:"flex-1 space-y-4 overflow-y-auto pr-2"},he={class:"rounded-lg bg-blue-50 p-4"},_e={class:"flex items-center space-x-3"},ge={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100"},be={class:"font-medium text-gray-900"},ye={key:1,class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},ke={class:"mb-3 font-medium text-gray-900"},we={class:"flex items-center space-x-3"},Ee={class:"space-y-2"},Ce={class:"space-y-6"},Se={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},je={class:"mb-3 flex items-center justify-between"},De={class:"flex items-center space-x-3"},ze={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100"},Fe={class:"text-sm font-medium"},$e={class:"font-medium text-gray-900"},Ne={class:"flex items-center space-x-2 text-sm text-gray-500"},Ve={key:0,class:"inline-flex items-center text-amber-600"},Me={key:0},Oe={key:1,class:"inline-flex items-center"},qe=["accept","data-file-type","onChange","disabled"],Le={key:0,class:"space-y-2"},Pe={class:"flex items-center justify-between"},Ae={class:"flex items-center space-x-3"},Be={class:"flex items-center space-x-2"},Ue={class:"text-sm font-medium text-gray-700"},Ie={key:0,class:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"},Re={class:"mt-1 space-y-1 text-xs text-gray-500"},Ge={class:"flex items-center space-x-2"},He={key:0},Xe={key:1,class:"inline-flex items-center"},Je={class:"flex items-center space-x-1"},Ke={key:0,class:"mr-2"},Te=["value","onChange","min"],We={key:1,class:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center"},Qe={class:"flex w-full items-center justify-between"},Ye={class:"text-sm text-gray-500"},Ze={class:"font-medium"},ut=ce({__name:"FilesModal",props:{staff:{type:Object,required:!0}},emits:["update-files"],setup($,{emit:R}){var O;const k=$,N=de(),C=g(!1),d=g(!1),f=g(""),w=g(null),h=g(null),E=g(""),y=g([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1},{label:"Certificado Ãšnico Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"DNI escaneado",key:"dni_escaneado",accept:".jpg,.jpeg,.png",maxSize:5,hasExpiration:!0},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de vacunaciÃ³n contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0}]);ue({staff_id:k.staff.id,files:[],user_id:(O=N.props.auth.user)==null?void 0:O.id});const G=(s,e,a)=>{var q;const n=s.target;if(!n.files||n.files.length===0)return;const l=n.files[0],u=y.value.find(D=>D.key===e);if(!u)return;if(l.size>u.maxSize*1024*1024){d.value=!0,f.value=`El archivo excede el tamaÃ±o mÃ¡ximo de ${u.maxSize}MB`,n.value="";return}const x=u.accept.split(",").map(D=>D.trim().toLowerCase()),Y="."+((q=l.name.split(".").pop())==null?void 0:q.toLowerCase());if(!x.includes(Y)){d.value=!0,f.value=`Tipo de archivo no vÃ¡lido. Formatos aceptados: ${u.accept}`,n.value="";return}if(w.value=e,u.hasExpiration&&a!==void 0){h.value=a;return}V(l,e),n.value=""},H=()=>{if(h.value===null||!E.value){d.value=!0,f.value="Debe seleccionar una fecha de expiraciÃ³n";return}const s=y.value[h.value].key,e=document.querySelector(`input[data-file-type="${s}"]`);if(!e||!e.files||e.files.length===0){d.value=!0,f.value="No se encontrÃ³ el archivo";return}const a=e.files[0];V(a,s,E.value),h.value=null,E.value="",e.value=""},V=(s,e,a)=>{var l,u;const n=new FormData;n.append("staff_id",k.staff.id.toString()),n.append("file_type",e),n.append("file",s),n.append("user_id",(l=N.props.auth.user)==null?void 0:l.id.toString()),a&&n.append("expiration_date",a),fetch(route("staff.upload-file"),{method:"POST",body:n,headers:{"X-CSRF-TOKEN":((u=document.querySelector('meta[name="csrf-token"]'))==null?void 0:u.getAttribute("content"))||""}}).then(x=>x.json()).then(x=>{x.success?(j("update-files"),d.value=!1):(d.value=!0,f.value=x.message||"Error al subir el archivo")}).catch(x=>{d.value=!0,f.value="Error en la conexiÃ³n",console.error(x)}).finally(()=>{w.value=null})},X=s=>{var e;confirm("Â¿EstÃ¡ seguro de eliminar este archivo?")&&fetch(route("staff.delete-file",s),{method:"DELETE",headers:{"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{a.success?(j("update-files"),d.value=!1):(d.value=!0,f.value=a.message||"Error al eliminar el archivo")}).catch(a=>{d.value=!0,f.value="Error en la conexiÃ³n",console.error(a)})},J=s=>{window.open(route("staff.download-file",s.id),"_blank")},K=s=>{window.open(route("staff.view-file",s.id),"_blank")},T=(s,e)=>{var a;fetch(route("staff.update-file-expiration",s),{method:"PUT",headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({expiration_date:e})}).then(n=>n.json()).then(n=>{n.success?j("update-files"):(d.value=!0,f.value=n.message||"Error al actualizar la fecha")}).catch(n=>{d.value=!0,f.value="Error en la conexiÃ³n",console.error(n)})},S=pe(()=>{const s={};return y.value.forEach(e=>{s[e.label]=[]}),k.staff.staff_files&&k.staff.staff_files.forEach(e=>{const a=y.value.find(n=>n.label===e.file_type);a&&s[a.label].push(e)}),s}),j=R,W=s=>new Date(s).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Q=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",M=s=>s?new Date(s)<new Date:!1;return(s,e)=>(r(),L(i(le),{open:C.value,"onUpdate:open":e[4]||(e[4]=a=>C.value=a)},{default:c(()=>[o(i(re),{"as-child":""},{default:c(()=>[o(_,{variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:c(()=>[o(i(z),{class:"h-4 w-4"})]),_:1})]),_:1}),o(i(se),{class:"flex max-h-[90vh] w-full flex-col sm:max-w-[900px]"},{default:c(()=>[o(i(ne),{class:"shrink-0 border-b pb-3"},{default:c(()=>[o(i(oe),null,{default:c(()=>e[5]||(e[5]=[v("GestiÃ³n de Documentos del Personal")])),_:1})]),_:1}),t("div",xe,[t("div",he,[t("div",_e,[t("div",ge,[o(i(z),{class:"h-5 w-5 text-blue-600"})]),t("div",null,[t("h3",be,m($.staff.name),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-600"},"GestiÃ³n de documentos y archivos",-1))])])]),e[16]||(e[16]=t("div",{class:"rounded-lg border border-amber-200 bg-amber-50 p-4"},[t("div",{class:"flex items-start"},[t("div",{class:"mt-0.5 mr-3"},[t("div",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-600"},"!")]),t("div",null,[t("h4",{class:"text-sm font-medium text-amber-800"},"AtenciÃ³n"),t("p",{class:"mt-1 text-sm text-amber-700"}," AsegÃºrese de que los archivos sean legibles (PDF, DOC, JPG, PNG) y que pesen menos de 10MB. Los documentos marcados con ðŸ“… requieren fecha de expiraciÃ³n. ")])])],-1)),d.value?(r(),L(i(Z),{key:0,variant:"destructive",class:"relative"},{default:c(()=>[t("button",{class:"absolute top-3 right-3 text-sm",onClick:e[0]||(e[0]=a=>d.value=!1)},"âœ•"),o(i(ee),null,{default:c(()=>e[7]||(e[7]=[v("Error")])),_:1}),o(i(te),null,{default:c(()=>[v(m(f.value),1)]),_:1})]),_:1})):b("",!0),h.value!==null?(r(),p("div",ye,[t("h4",ke,"Seleccionar fecha de expiraciÃ³n para "+m(y.value[h.value].label),1),t("div",we,[o(i(ae),{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value=a),class:"rounded-md border","min-date":new Date},null,8,["modelValue","min-date"]),t("div",Ee,[o(_,{onClick:H,class:"w-full"},{default:c(()=>[o(i(I),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=v(" Subir con fecha "))]),_:1}),o(_,{variant:"outline",onClick:e[2]||(e[2]=a=>h.value=null),class:"w-full"},{default:c(()=>e[9]||(e[9]=[v(" Cancelar ")])),_:1})])])])):b("",!0),t("div",Ce,[(r(!0),p(P,null,A(y.value,(a,n)=>(r(),p("div",{key:n,class:"space-y-3"},[t("div",Se,[t("div",je,[t("div",De,[t("div",ze,[t("span",Fe,m(n+1),1)]),t("div",null,[t("h4",$e,m(a.label),1),t("div",Ne,[t("span",null,"Formatos: "+m(a.accept.replace(/\./g,"").toUpperCase()),1),e[11]||(e[11]=t("span",null,"â€¢",-1)),t("span",null,"MÃ¡x: "+m(a.maxSize)+"MB",1),a.hasExpiration?(r(),p("span",Ve,[o(i(U),{class:"ml-2 h-4 w-4"}),e[10]||(e[10]=t("span",{class:"ml-1"},"Requiere fecha",-1))])):b("",!0)])])]),t("label",{class:B(["cursor-pointer rounded-md px-4 py-2 text-sm font-medium transition-colors",w.value===a.key?"cursor-not-allowed bg-blue-400 text-white":"bg-blue-600 text-white hover:bg-blue-700"])},[w.value===a.key?(r(),p("span",Me,e[12]||(e[12]=[t("span",{class:"inline-flex items-center"},[t("svg",{class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),v(" Subiendo... ")],-1)]))):(r(),p("span",Oe,[o(i(I),{class:"mr-2 h-4 w-4"}),e[13]||(e[13]=v(" Subir "))])),t("input",{type:"file",accept:a.accept,class:"hidden","data-file-type":a.key,onChange:l=>G(l,a.key,n),disabled:w.value!==null},null,40,qe)],2)]),S.value[a.label]&&S.value[a.label].length>0?(r(),p("div",Le,[(r(!0),p(P,null,A(S.value[a.label],l=>(r(),p("div",{key:l.id,class:B(["rounded-lg border p-3 transition-colors",M(l.expiration_date)?"border-red-200 bg-red-50":"border-green-200 bg-green-50"])},[t("div",Pe,[t("div",Ae,[t("div",null,[t("div",Be,[t("p",Ue,m(l.path),1),M(l.expiration_date)?(r(),p("span",Ie," VENCIDO ")):b("",!0)]),t("div",Re,[t("p",null,"Subido: "+m(W(l.created_at)),1),t("div",Ge,[l.user_name?(r(),p("span",He,"Por: "+m(l.user_name),1)):b("",!0),a.hasExpiration?(r(),p("span",Xe,[o(i(U),{class:"mr-1 h-3 w-3"}),v(" Vence: "+m(Q(l.expiration_date)),1)])):b("",!0)])])])]),t("div",Je,[a.hasExpiration?(r(),p("div",Ke,[t("input",{type:"date",value:l.expiration_date||"",onChange:u=>T(l.id,u.target.value),class:"rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,40,Te)])):b("",!0),o(_,{variant:"ghost",size:"icon",class:"h-8 w-8 text-blue-600 hover:bg-blue-100",onClick:u=>K(l),title:"Vista previa"},{default:c(()=>[o(i(ve),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(_,{variant:"ghost",size:"icon",class:"h-8 w-8 text-green-600 hover:bg-green-100",onClick:u=>J(l),title:"Descargar"},{default:c(()=>[o(i(fe),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(_,{variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600 hover:bg-red-100",onClick:u=>X(l.id),title:"Eliminar"},{default:c(()=>[o(i(me),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])],2))),128))])):(r(),p("div",We,[o(i(z),{class:"mx-auto h-8 w-8 text-gray-400"}),e[14]||(e[14]=t("p",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay archivos subidos",-1)),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500"},'Haz clic en "Subir" para agregar un documento',-1))]))])]))),128))])]),o(i(ie),{class:"border-t pt-4"},{default:c(()=>{var a;return[t("div",Qe,[t("div",Ye,[t("span",Ze,m(((a=k.staff.staff_files)==null?void 0:a.length)||0),1),e[17]||(e[17]=v(" archivos en total "))]),o(_,{variant:"outline",onClick:e[3]||(e[3]=n=>C.value=!1)},{default:c(()=>e[18]||(e[18]=[v("Cerrar")])),_:1})])]}),_:1})]),_:1})]),_:1},8,["open"]))}});export{ut as _};
