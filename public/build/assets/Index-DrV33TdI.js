import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-DCqL4m5v.js";import{d as V,k as a,c as q,o as B,a as r,u as E,m as R,w as T,b as v,F as J,s as j}from"./app-DHc17Srm.js";import{_ as z}from"./Alert.vue_vue_type_script_setup_true_lang-zn-slyla.js";import{_ as G}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-C-6o3v5C.js";import{_ as K}from"./SalesCard.vue_vue_type_script_setup_true_lang-Btt2_Sr0.js";import{_ as L}from"./SalesHeader.vue_vue_type_script_setup_true_lang-BDvkMNnY.js";import{_ as M}from"./SalesTable.vue_vue_type_script_setup_true_lang-CXppfKRM.js";import"./utils-bRKmu4jq.js";import"./index-CIvCiRTE.js";import"./useForwardPropsEmits-Bh0u6_9R.js";import"./Primitive-M5IC-HPY.js";import"./useForwardExpose-4dZel9K6.js";import"./useFocusGuards-FUnUJITZ.js";import"./Teleport-Whf5mvBy.js";import"./VisuallyHidden-CscJcbio.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DzQO7hTB.js";import"./Collection-BM5cLq94.js";import"./usePrimitiveElement-BB2VZ2uY.js";import"./utils-D4lt8Rum.js";import"./useTypeahead-DkMgZjaj.js";import"./RovingFocusGroup-C19OEW30.js";import"./createLucideIcon-BGi-3XUC.js";import"./x-DyshcwK_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-IzW_N_hc.js";import"./user-4V6LbfE_.js";import"./chevron-right-Da8e_tY3.js";import"./index-D0wnr5TQ.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-bjbebw9K.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Cxe9KhUD.js";import"./Card.vue_vue_type_script_setup_true_lang-C5QVMjOK.js";import"./Input.vue_vue_type_script_setup_true_lang-L6aj2xCP.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-4AFGQpAe.js";import"./nullish-CHIgUVhi.js";import"./check-DNMH_Akj.js";import"./RovingFocusItem-CTvkVA0M.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-BWFFZJcq.js";import"./chevron-left-5tgZD_cg.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-BiBzqU-i.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-ITyzNaQ-.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-BaE93l7v.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-mCjat44c.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-DWeWvCpk.js";import"./PricesDialog.vue_vue_type_script_setup_true_lang-D1yu63JI.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-BNsNOoEO.js";import"./loader-circle-bMpNiDim.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-8zwNlTWu.js";import"./TableCell.vue_vue_type_script_setup_true_lang-zVA6bRtS.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-eoKznxHn.js";const Q={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},W={class:"grid auto-rows-min gap-4 md:grid-cols-2"},Le=V({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},sales:{}},setup(x){const p=a(null),F=x,s=a([]),A=e=>s.value.some(t=>t.serviceID===e.id),C=e=>{if(A(e)){s.value=s.value.filter(t=>t.serviceID!==e.id);return}s.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},U=e=>{I.value=e},f=a([...F.sales]),I=a([]),_=a(!1),h=a(""),S=a(""),l=a(""),c=a(!1),d=a(!1),n=(e,t)=>{var o;h.value=((o=t.response)==null?void 0:o.data.message)||t||"Ha ocurrido un error inesperado.",S.value=e,_.value=!0},y=()=>{c.value=!0},P=()=>{c.value=!1,d.value=!1},$=e=>{l.value=e},k=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else m(e)},g=a(0),D=a(0),w=a(0),H=e=>{g.value=e.cafe_id,D.value=e.sale_type_id,w.value=e.receipt_type_id},N=e=>{var t;d.value=!0,m((t=u.value)==null?void 0:t.dni)},u=a({}),b=a({}),m=e=>{const t=new FormData;if(t.append("cafe_id",g.value),t.append("sale_type_id",D.value),t.append("receipt_type",w.value),t.append("services",JSON.stringify(s.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",d.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}j.post("./sales",t).then(o=>{var i;o.data.dinner&&(u.value=o.data.dinner,b.value=o.data.dinner.subdealership,n("success",o.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),f.value=o.data.sales||[]),o.data.otherCafe&&y()}).catch(o=>{var i;console.error("Error fetching dinners:",o),n("error",o),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(B(),q(J,null,[r(E(R),{title:"Comensales"}),r(O,null,{default:T(()=>[r(z,{showAlert:_.value,type:S.value,description:h.value},null,8,["showAlert","type","description"]),v("div",Q,[t[0]||(t[0]=v("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),r(L,{cafes:e.cafes,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:U,onUpdateDate:$,onUpdateFormData:H,onAddServiceSelected:C},null,8,["cafes","services","receipt_types","sale_types"]),v("div",W,[r(K,{dinnerFound:u.value,subdealership:b.value,onHandleShowAlert:n,onShowDialog:y,onSaveSale:m,onUpdateDni:k,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),r(M,{sales:f.value},null,8,["sales"]),r(G,{showOtherUnitDialog:c.value,onHideDialog:P,onHandleDoublePriceSave:N},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{Le as default};
