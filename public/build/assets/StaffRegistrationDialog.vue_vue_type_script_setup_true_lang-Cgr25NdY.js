import{_ as y}from"./index-BZlWQk1C.js";import{_ as V,a as z,b as M,c as O}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D6PlnhoX.js";import{_ as L}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DD2MZiGV.js";import{_ as G}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DSEbHgSB.js";import{_ as Z}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CH8jsaOz.js";import{c as W,_ as X,a as F,b as w}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-GYl8S1u7.js";import{_ as H}from"./AlertErrors.vue_vue_type_script_setup_true_lang-Jx5L-Tdo.js";import{j as c,C as J,d as K,g as I,o as U,w as s,a as t,u as e,e as g,b as D,i as Q}from"./app-D7L7GUyk.js";import{_ as Y}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-DQRZF7y_.js";import{_ as q}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-BoleILt8.js";import{_ as ee}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-FNj1sLIL.js";import{_ as ae}from"./SizesTab.vue_vue_type_script_setup_true_lang-Dzc31ryq.js";const le=9*1024*1024;function te(){const n=c(!1),u=c(""),o=c([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:o,showAlert:n,alertMessage:u,handleFileUpload:(x,f,h)=>{const m=x.target.files;if(m.length>0){const i=m[0];if(i.size>le)u.value="El archivo es demasiado grande. El máximo es 9MB.",n.value=!0;else{const r=o.value.find(d=>d.label==f);if(r){const p=i.name.split(".").pop(),l=new File([i],`${f}_${Date.now()}.${p}`,{type:i.type});h.push({file:l,label:f}),r.file=l}}}},handleDateFile:(x,f)=>{o.value[f].expirationDate=x}}}function oe(){const n=c(null),u=c(null),o=c(null);return{fileInput:n,imagePreview:u,selectedFile:o,triggerFileInput:()=>{var f;(f=n.value)==null||f.click()},handleImageUpload:f=>{var i;const m=(i=f.target.files)==null?void 0:i[0];if(m){if(!m.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const r=5*1024*1024;if(m.size>r){alert("La imagen es demasiado grande. Máximo 5MB");return}o.value=m;const d=new FileReader;d.onload=p=>{var l;u.value=(l=p.target)==null?void 0:l.result},d.readAsDataURL(m)}},removeImage:()=>{u.value=null,o.value=null,n.value&&(n.value.value="")}}}function se(){const n=J({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",fechaIngreso:"",fechaFinContract:"",cc:"",cci:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[]}),u=c([]),o=c(!1),b=c([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),_=c([]);return{form:n,errorsSend:u,showErrors:o,prendasFijas:b,cafesUnitSelected:_,handleSubmit:(i,r)=>{let d;Array.isArray(r)?d=r:r&&typeof r=="object"?d=Array.isArray(r.value)?r.value:Object.values(r):d=[],d.forEach(l=>{l&&l.expirationDate===null?n.filesData.push({expirationDate:"-"}):n.filesData.push({expirationDate:l.expirationDate})}),console.log("filesArray:",d);const p=d.filter(l=>l&&typeof l=="object").map(l=>l.file).filter(l=>l instanceof File);if(console.log("Archivos válidos a subir:",p.length,p),p.length===0){console.error("No hay archivos válidos para subir"),o.value=!0,u.value={files:["No hay archivos seleccionados"]};return}n.prendas=b.value,n.files=p,n.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:l=>{n.reset(),i()},onError:l=>{o.value=!0,u.value=l,console.error("Error al subir el archivo:",l)}})},selectCafe:i=>{n.cafeId=i.id},selectRole:i=>{n.roleId=i.id},selectUnit:i=>{n.unitId=i.id,_.value=i.cafes,n.unitSelectedText=i.name}}}const ne={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},_e=K({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{}},setup(n){const u=c(!1),o=c("personal"),{form:b,errorsSend:_,showErrors:x,prendasFijas:f,cafesUnitSelected:h,handleSubmit:m,selectCafe:i,selectRole:r,selectUnit:d}=se(),{fileInput:p,imagePreview:l,triggerFileInput:j,handleImageUpload:S,removeImage:E}=oe(),{filesRequired:$,showAlert:k,alertMessage:R,handleFileUpload:A,handleDateFile:T}=te(),N=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a<v.length-1&&(o.value=v[a+1])},B=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a>0&&(o.value=v[a-1])},P=()=>{m(()=>{u.value=!1,o.value="personal"},$)};return(v,a)=>(U(),I(e(O),{open:u.value,"onUpdate:open":a[2]||(a[2]=C=>u.value=C)},{default:s(()=>[t(e(Z),{"as-child":""},{default:s(()=>[t(e(y),{variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[3]||(a[3]=[g(" Nuevo Personal ")])),_:1})]),_:1}),t(e(V),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:s(()=>[D("input",{type:"file",ref_key:"fileInput",ref:p,onChange:a[0]||(a[0]=(...C)=>e(S)&&e(S)(...C)),accept:"image/*",class:"hidden"},null,544),t(e(z),{class:"z-10 border-b bg-white px-6 py-4"},{default:s(()=>[t(e(M),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:s(()=>a[4]||(a[4]=[g(" Ficha de Registro de Colaborador ")])),_:1}),t(e(L),null,{default:s(()=>a[5]||(a[5]=[g(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),t(H,{show:e(x),errors:e(_)},null,8,["show","errors"])]),_:1}),D("div",ne,[t(e(W),{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=C=>o.value=C),class:"w-full"},{default:s(()=>[t(e(X),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:s(()=>[t(e(F),{value:"personal",class:"text-xs md:text-sm"},{default:s(()=>a[6]||(a[6]=[g("1. Personal")])),_:1}),t(e(F),{value:"adjuntos",class:"text-xs md:text-sm"},{default:s(()=>a[7]||(a[7]=[g("2. Adjuntos")])),_:1}),t(e(F),{value:"financiero",class:"text-xs md:text-sm"},{default:s(()=>a[8]||(a[8]=[g("3. Financiero")])),_:1}),t(e(F),{value:"tallas",class:"text-xs md:text-sm"},{default:s(()=>a[9]||(a[9]=[g("4. Tallas")])),_:1})]),_:1}),t(e(w),{value:"personal",class:"mt-0"},{default:s(()=>[t(ee,{form:e(b),cafes:e(h),units:v.units,roles:v.roles,"image-preview":e(l),onTriggerUpload:e(j),onRemoveImage:e(E),onSelectCafe:e(i),onSelectUnit:e(d),onSelectRole:e(r)},null,8,["form","cafes","units","roles","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole"])]),_:1}),t(e(w),{value:"adjuntos",class:"mt-0"},{default:s(()=>[t(Y,{"files-required":e($),"show-alert":e(k),"alert-message":e(R),form:e(b),onUploadFile:e(A),onUploadDate:e(T)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),t(e(w),{value:"financiero",class:"mt-0"},{default:s(()=>[t(q,{form:e(b),roles:v.roles,onSelectRole:e(r),onUploadFile:e(A)},null,8,["form","roles","onSelectRole","onUploadFile"])]),_:1}),t(e(w),{value:"tallas",class:"mt-0"},{default:s(()=>[t(ae,{prendas:e(f)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),t(e(G),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:s(()=>[D("div",null,[o.value!=="personal"?(U(),I(e(y),{key:0,onClick:B,variant:"outline",type:"button"},{default:s(()=>a[10]||(a[10]=[g(" ← Anterior ")])),_:1})):Q("",!0)]),D("div",null,[o.value!=="tallas"?(U(),I(e(y),{key:0,onClick:N,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[11]||(a[11]=[g(" Siguiente → ")])),_:1})):(U(),I(e(y),{key:1,onClick:P,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:s(()=>a[12]||(a[12]=[g(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{_e as _};
