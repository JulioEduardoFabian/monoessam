import{_ as w}from"./index-Do3SaZ9E.js";import{_ as M,a as N,b as O,c as L}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BH_E8Vw0.js";import{_ as G}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DE6RCTyQ.js";import{_ as Z}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DIf4kgcX.js";import{_ as W}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-axX_gvW6.js";import{c as X,_ as H,a as I,b as y}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DxmxrAoJ.js";import{_ as J}from"./AlertErrors.vue_vue_type_script_setup_true_lang-BGx_kS34.js";import{j as c,C as K,d as Q,g as S,o as U,w as s,a as l,u as e,e as g,b as D,i as Y}from"./app-mBQVMYJb.js";import{_ as q}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-CKawdpIu.js";import{_ as ee}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-Dm8khMyr.js";import{_ as ae}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-LkQOsg--.js";import{_ as le}from"./SizesTab.vue_vue_type_script_setup_true_lang-Drob3KES.js";const te=9*1024*1024;function se(){const t=c(!1),u=c(""),o=c([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:o,showAlert:t,alertMessage:u,handleFileUpload:(_,d,h)=>{const m=_.target.files;if(m.length>0){const b=m[0];if(b.size>te)u.value="El archivo es demasiado grande. El máximo es 9MB.",t.value=!0;else{const n=o.value.find(r=>r.label==d);if(n){const f=b.name.split(".").pop(),p=new File([b],`${d}_${Date.now()}.${f}`,{type:b.type});h.push({file:p,label:d}),n.file=p}}}},handleDateFile:(_,d)=>{o.value[d].expirationDate=_}}}function oe(){const t=c(null),u=c(null),o=c(null);return{fileInput:t,imagePreview:u,selectedFile:o,triggerFileInput:()=>{var d;(d=t.value)==null||d.click()},handleImageUpload:d=>{var b;const m=(b=d.target.files)==null?void 0:b[0];if(m){if(!m.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const n=5*1024*1024;if(m.size>n){alert("La imagen es demasiado grande. Máximo 5MB");return}o.value=m;const r=new FileReader;r.onload=f=>{var p;u.value=(p=f.target)==null?void 0:p.result},r.readAsDataURL(m)}},removeImage:()=>{u.value=null,o.value=null,t.value&&(t.value.value="")}}}function ne(){const t=K({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",fechaIngreso:"",fechaFinContract:"",cc:"",cci:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),u=c([]),o=c(!1),x=c([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),C=c([]);return{form:t,errorsSend:u,showErrors:o,prendasFijas:x,cafesUnitSelected:C,handleSubmit:(n,r)=>{let f;Array.isArray(r)?f=r:r&&typeof r=="object"?f=Array.isArray(r.value)?r.value:Object.values(r):f=[],f.forEach(i=>{i&&i.expirationDate===null?t.filesData.push({expirationDate:"-"}):t.filesData.push({expirationDate:i.expirationDate})}),console.log("filesArray:",f);const p=f.filter(i=>i&&typeof i=="object").map(i=>i.file).filter(i=>i instanceof File);console.log("Archivos válidos a subir:",p.length,p),t.prendas=x.value,t.files=p,t.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:i=>{t.reset(),n()},onError:i=>{o.value=!0,u.value=i,console.error("Error al subir el archivo:",i)}})},selectCafe:n=>{t.cafeId=n.id},selectRole:n=>{t.roleId=n.id},selectUnit:n=>{t.unitId=n.id,C.value=n.cafes,t.unitSelectedText=n.name},selectArea:n=>{t.areaId=n}}}const ie={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ce=Q({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{}},setup(t){const u=c(!1),o=c("personal"),{form:x,errorsSend:C,showErrors:_,prendasFijas:d,cafesUnitSelected:h,handleSubmit:m,selectCafe:b,selectRole:n,selectUnit:r,selectArea:f}=ne(),{fileInput:p,imagePreview:i,triggerFileInput:E,handleImageUpload:$,removeImage:k}=oe(),{filesRequired:A,showAlert:R,alertMessage:T,handleFileUpload:j,handleDateFile:B}=se(),P=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a<v.length-1&&(o.value=v[a+1])},V=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a>0&&(o.value=v[a-1])},z=()=>{m(()=>{u.value=!1,o.value="personal"},A)};return(v,a)=>(U(),S(e(L),{open:u.value,"onUpdate:open":a[2]||(a[2]=F=>u.value=F)},{default:s(()=>[l(e(W),{"as-child":""},{default:s(()=>[l(e(w),{variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[3]||(a[3]=[g(" Nuevo Personal ")])),_:1})]),_:1}),l(e(M),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:s(()=>[D("input",{type:"file",ref_key:"fileInput",ref:p,onChange:a[0]||(a[0]=(...F)=>e($)&&e($)(...F)),accept:"image/*",class:"hidden"},null,544),l(e(N),{class:"z-10 border-b bg-white px-6 py-4"},{default:s(()=>[l(e(O),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:s(()=>a[4]||(a[4]=[g(" Ficha de Registro de Colaborador ")])),_:1}),l(e(G),null,{default:s(()=>a[5]||(a[5]=[g(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),l(J,{show:e(_),errors:e(C)},null,8,["show","errors"])]),_:1}),D("div",ie,[l(e(X),{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=F=>o.value=F),class:"w-full"},{default:s(()=>[l(e(H),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:s(()=>[l(e(I),{value:"personal",class:"text-xs md:text-sm"},{default:s(()=>a[6]||(a[6]=[g("1. Personal")])),_:1}),l(e(I),{value:"adjuntos",class:"text-xs md:text-sm"},{default:s(()=>a[7]||(a[7]=[g("2. Adjuntos")])),_:1}),l(e(I),{value:"financiero",class:"text-xs md:text-sm"},{default:s(()=>a[8]||(a[8]=[g("3. Financiero")])),_:1}),l(e(I),{value:"tallas",class:"text-xs md:text-sm"},{default:s(()=>a[9]||(a[9]=[g("4. Tallas")])),_:1})]),_:1}),l(e(y),{value:"personal",class:"mt-0"},{default:s(()=>[l(ae,{form:e(x),cafes:e(h),units:v.units,roles:v.roles,businneses:v.businneses,"image-preview":e(i),onTriggerUpload:e(E),onRemoveImage:e(k),onSelectCafe:e(b),onSelectUnit:e(r),onSelectRole:e(n),onSelectArea:e(f)},null,8,["form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),l(e(y),{value:"adjuntos",class:"mt-0"},{default:s(()=>[l(q,{"files-required":e(A),"show-alert":e(R),"alert-message":e(T),form:e(x),onUploadFile:e(j),onUploadDate:e(B)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),l(e(y),{value:"financiero",class:"mt-0"},{default:s(()=>[l(ee,{form:e(x),roles:v.roles,onSelectRole:e(n),onUploadFile:e(j)},null,8,["form","roles","onSelectRole","onUploadFile"])]),_:1}),l(e(y),{value:"tallas",class:"mt-0"},{default:s(()=>[l(le,{prendas:e(d)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),l(e(Z),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:s(()=>[D("div",null,[o.value!=="personal"?(U(),S(e(w),{key:0,onClick:V,variant:"outline",type:"button"},{default:s(()=>a[10]||(a[10]=[g(" ← Anterior ")])),_:1})):Y("",!0)]),D("div",null,[o.value!=="tallas"?(U(),S(e(w),{key:0,onClick:P,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[11]||(a[11]=[g(" Siguiente → ")])),_:1})):(U(),S(e(w),{key:1,onClick:z,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:s(()=>a[12]||(a[12]=[g(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ce as _};
