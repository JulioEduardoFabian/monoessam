import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-DyFkDwLf.js";import{d as q,k as a,n as E,c as R,o as C,a as o,u as x,m as T,w as J,b as f,g as j,i as z,F as G,s as K}from"./app-DCLn6De8.js";import{_ as L}from"./SubdealershipsDialog.vue_vue_type_script_setup_true_lang-DTGpwDbZ.js";import{_ as M}from"./Alert.vue_vue_type_script_setup_true_lang-eJLZIaHp.js";import{_ as Q}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-DVA_KYap.js";import{_ as W}from"./SalesCard.vue_vue_type_script_setup_true_lang-BTX24Dik.js";import{_ as X}from"./SalesHeader.vue_vue_type_script_setup_true_lang-By9Pqss8.js";import{_ as Y}from"./SalesTable.vue_vue_type_script_setup_true_lang-BhQRactc.js";import"./utils-bRKmu4jq.js";import"./index-e1y-wXr5.js";import"./useForwardPropsEmits-DV2zn-wQ.js";import"./Primitive-CZkuYOof.js";import"./useForwardExpose-BqsDow3k.js";import"./useFocusGuards-xJYwFlmr.js";import"./Teleport-BmSppfU3.js";import"./VisuallyHidden-BWkOrkJh.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D-wLgl3u.js";import"./Collection-CrXy-rPV.js";import"./usePrimitiveElement-Clo8lFs2.js";import"./utils-TkNtQw1K.js";import"./useTypeahead-B3tkSQvv.js";import"./RovingFocusGroup-CPHp5YbN.js";import"./createLucideIcon-BttnQq3J.js";import"./x-H7BCGvR2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-Di6-tnvm.js";import"./user-DGMwMf9T.js";import"./chevron-right-B67PVtRA.js";import"./index-Cb9sS1QI.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BcHgmN8F.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CL-fgpKF.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-DpY-3j1e.js";import"./Input.vue_vue_type_script_setup_true_lang-LT2poMoX.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-C1kdE6ZU.js";import"./chevron-down-CXtz03pH.js";import"./check-YAVQmvuw.js";import"./nullish-CHIgUVhi.js";import"./SelectLabel.vue_vue_type_script_setup_true_lang-DAIy0Ex-.js";import"./circle-plus-az6is6Uv.js";import"./Card.vue_vue_type_script_setup_true_lang-0d9kOeG0.js";import"./building-wWaLmYOg.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-jBoCuouY.js";import"./RovingFocusItem-DFkQUboE.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-DrHh2XUc.js";import"./chevron-left-BHQxov1f.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-CosVxggx.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-GXz75CSy.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-BzENcuc9.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-CdNHHPRV.js";import"./NewDinnerDialog.vue_vue_type_script_setup_true_lang-CokiHZHM.js";import"./user-plus-DoAQwzDh.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-C0MCey4R.js";import"./loader-circle-CVNk2PYg.js";import"./coffee-CQOfT4Ul.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-BVDM3liC.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-jCbUxnoZ.js";const Z={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ee={class:"grid auto-rows-min gap-4 md:grid-cols-2"},it=q({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},sales:{},subdealerships:{},dealerships:{}},setup(te){const p=a(null),A=E().props.auth.permissions,r=a([]),U=e=>r.value.some(t=>t.serviceID===e.id),I=e=>{if(U(e)){r.value=r.value.filter(t=>t.serviceID!==e.id);return}r.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},$=(e,t)=>{k.value=e,d.value=t},d=a([]),k=a([]),_=a(!1),h=a(""),S=a(""),l=a(""),c=a(!1),u=a(!1),n=(e,t)=>{var s;h.value=((s=t.response)==null?void 0:s.data.message)||t||"Ha ocurrido un error inesperado.",S.value=e,_.value=!0},m=a(""),y=()=>{c.value=!0},P=()=>{c.value=!1,u.value=!1},N=e=>{l.value=e},V=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else v(e)},g=a(0),D=a(0),w=a(0),B=e=>{g.value=e.cafe_id,D.value=e.sale_type_id,w.value=e.receipt_type_id},H=e=>{u.value=!0,v(m.value)},b=a({}),F=a({}),v=e=>{m.value=e;const t=new FormData;if(t.append("cafe_id",g.value),t.append("sale_type_id",D.value),t.append("receipt_type",w.value),t.append("services",JSON.stringify(r.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",u.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}K.post("./sales",t).then(s=>{var i;s.data.dinner&&(b.value=s.data.dinner,F.value=s.data.dinner.subdealership,n("success",s.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),d.value=s.data.sales||[]),s.data.otherCafe&&(console.log(m.value),y())}).catch(s=>{var i;console.error("Error fetching dinners:",s),n("error",s),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(C(),R(G,null,[o(x(T),{title:"Comensales"}),o(O,null,{default:J(()=>[o(M,{showAlert:_.value,type:S.value,description:h.value},null,8,["showAlert","type","description"]),f("div",Z,[t[0]||(t[0]=f("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),x(A).find(s=>s.id==14)?(C(),j(L,{key:0,dealerships:e.dealerships},null,8,["dealerships"])):z("",!0),o(X,{cafes:e.cafes,subdealerships:e.subdealerships,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:$,onUpdateDate:N,onUpdateFormData:B,onAddServiceSelected:I},null,8,["cafes","subdealerships","services","receipt_types","sale_types"]),f("div",ee,[o(W,{dinnerFound:b.value,subdealership:F.value,onHandleShowAlert:n,onShowDialog:y,onSaveSale:v,onUpdateDni:V,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),o(Y,{sales:d.value},null,8,["sales"]),o(Q,{showOtherUnitDialog:c.value,onHideDialog:P,onHandleDoublePriceSave:H},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{it as default};
