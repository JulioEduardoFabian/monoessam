import{_}from"./index-CUg2aZ3x.js";import{_ as $,a as b,b as S,c as U,d as G}from"./SelectValue.vue_vue_type_script_setup_true_lang-Vdd2l3Vl.js";import{_ as V,a as C}from"./SelectLabel.vue_vue_type_script_setup_true_lang-BuG70Oa8.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bxa0oQ08.js";import{d as H,j as c,s as O,v as J,c as m,o as i,a,u as t,m as K,w as o,b as r,e as d,F as v,p as h,g as D,t as I}from"./app-BlZoMQ2y.js";import Q from"./GuardAreaDroppable-DXlsENCK.js";import{_ as W}from"./GuardModal.vue_vue_type_script_setup_true_lang-CPX39hcb.js";import{_ as X}from"./StaffSelectables.vue_vue_type_script_setup_true_lang-0Yd7g2CQ.js";import{_ as Y}from"./TableHeadcount.vue_vue_type_script_setup_true_lang-C6lI1M70.js";import{c as Z}from"./createLucideIcon-Bam5mdgP.js";import{S as ee}from"./sheet-mimCYqY3.js";import"./Primitive-dUZogcy0.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-C2pep5PW.js";import"./useForwardExpose-DJ7tHVRH.js";import"./Teleport-6-9e_ncv.js";import"./chevron-down-jv8dIr5a.js";import"./Collection-DQVYbaRO.js";import"./usePrimitiveElement-CsoKa0z6.js";import"./check-B1jbDQUD.js";import"./PopperContent-BQUtg6Dl.js";import"./useTypeahead-ChBMltu5.js";import"./utils-Be3fPPoN.js";import"./VisuallyHidden-BX6Jj9Sy.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CfMFx4F3.js";import"./RovingFocusGroup-BxHsP134.js";import"./DialogTitle-DBzC8VJx.js";import"./x-BxpBCfXk.js";import"./DialogDescription-ztaxFapT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./hand-helping-CLMqTRkO.js";import"./building-2-DSL9Hze5.js";import"./user-Ds8Kd1W1.js";import"./chevron-right-DS9VtUx0.js";import"./GuardRolesDropzone-C6Holqb5.js";import"./Draggable-B_f1l1Eg.js";import"./GuardRolesModal-JYjtHPk9.js";import"./index-CY-zzmie.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Cz9h-9Sx.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-xXKV7hdh.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-D1djLFSk.js";import"./Input.vue_vue_type_script_setup_true_lang-BNiIumkS.js";import"./plus-C3F1pj2N.js";import"./circle-alert-BoW8i_ah.js";import"./trash-CZar3KuZ.js";import"./Label.vue_vue_type_script_setup_true_lang-WjYs8mdd.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-BBEGBhGl.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=Z("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ae={class:"flex h-full flex-1 flex-col gap-6 p-6"},le={class:"flex w-full flex-row gap-2"},te={class:"flex gap-2"},oe=["hidden"],re={key:0,class:"grid h-full auto-rows-fr gap-6 md:grid-cols-8"},ne={class:"md:col-span-6"},ie={class:"flex h-full gap-6"},ue={key:1,class:"flex h-full items-center justify-center p-10 text-center"},de=["hidden"],fe={class:"grid h-full"},rs=H({__name:"Index",props:{users:{},roles:{},permissions:{},areas:{},headquarters:{},mines:{},units:{}},setup(E){const M=E,n=c({mine:null,unit:null,cafe:null}),x=c([]),k=c([]),A=c([]),u=c([]),g=c(!1),p=c([]),y=c([]);O(n,l=>{if(l.mine!==null&&l.mine!==void 0){const e=M.mines.find(s=>String(s.id)===String(l.mine));x.value=e?e.units:[]}if(l.unit){const e=x.value.find(s=>s.id==l.unit);k.value=e?e.cafes:[]}l.cafe&&w(Number(l.cafe))},{deep:!0});const w=async l=>{try{const s=(await J.get(`/cafes/${l}`)).data;u.value=s.guards,p.value=s.users.unassigned,y.value=s.users.assigned,A.value=s.periods}catch(e){console.error("Error fetching cafe data:",e)}},z=l=>{p.value=p.value.filter(e=>e.id!==l),w(n.value.cafe)},L=l=>{console.log("updating guards",l),u.value=l},R=(l,e)=>{const s=u.value.find(f=>f.id===l);s&&(s.assigned_roles=[],e.forEach(f=>{const q={role:{id:f.id,guard_id:l,role_id:f.id,name:f.name}};s.assigned_roles.push(q)}))},j=(l,e)=>{const s=u.value.find(f=>f.id===l);console.log(e),s&&(s.assigned_roles=s.assigned_roles.filter(f=>f.id!==e))},B=l=>{u.value=u.value.filter(e=>e.id!==l)},N=l=>{k.value.find(e=>e.id==n.value.cafe)},P=()=>{g.value=!g.value},T=()=>{const l=n.value.cafe;if(!l){alert("Por favor seleccione un comedor antes de exportar.");return}window.location.href=`/cafes/${l}/export-headcount`};return(l,e)=>(i(),m(v,null,[a(t(K),{title:"Headcount"}),a(F,null,{default:o(()=>[r("div",ae,[e[11]||(e[11]=r("div",{class:"flex"},[r("h1",{class:"text-2xl font-bold"},"Puestos")],-1)),e[12]||(e[12]=r("p",null,"Seleccione una mina, unidad y comedor para asignar guardias y roles",-1)),r("div",le,[a(_,{title:"Ver en lista",class:"cursor-pointer",onClick:e[0]||(e[0]=s=>P())},{default:o(()=>[a(t(se))]),_:1}),a(_,{class:"cursor-pointer bg-green-500",title:"Exportar Headcount en Excel",onClick:e[1]||(e[1]=s=>T())},{default:o(()=>[a(t(ee))]),_:1})]),r("div",te,[a(t($),{class:"w-full",modelValue:n.value.mine,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.mine=s)},{default:o(()=>[a(t(b),{class:"w-full"},{default:o(()=>[a(t(S),{placeholder:"Selecciona una mina"})]),_:1}),a(t(U),null,{default:o(()=>[a(t(V),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[5]||(e[5]=[d("Minas")])),_:1}),(i(!0),m(v,null,h(M.mines,s=>(i(),D(t(G),{value:String(s.id),key:s.id},{default:o(()=>[d(I(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t($),{class:"w-full",modelValue:n.value.unit,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.unit=s)},{default:o(()=>[a(t(b),{class:"w-full"},{default:o(()=>[a(t(S),{placeholder:"Selecciona una unidad minera"})]),_:1}),a(t(U),null,{default:o(()=>[a(t(V),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[6]||(e[6]=[d("Unidades mineras")])),_:1}),(i(!0),m(v,null,h(x.value,s=>(i(),D(t(G),{value:s.id,key:s.id},{default:o(()=>[d(I(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t($),{class:"w-full",modelValue:n.value.cafe,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.cafe=s)},{default:o(()=>[a(t(b),{class:"w-full"},{default:o(()=>[a(t(S),{placeholder:"Selecciona un comedor"})]),_:1}),a(t(U),null,{default:o(()=>[a(t(V),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[7]||(e[7]=[d("Comedores")])),_:1}),(i(!0),m(v,null,h(k.value,s=>(i(),D(t(G),{value:s.id,key:s.id},{default:o(()=>[d(I(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(W,{cafeId:n.value.cafe,onAssignGuards:L},null,8,["cafeId"]),a(_,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>e[8]||(e[8]=[d(" Agregar roles ")])),_:1}),a(_,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>e[9]||(e[9]=[d(" Agregar puesto ")])),_:1})]),r("div",{class:"h-full",hidden:g.value},[u.value&&u.value.length>0?(i(),m("div",re,[a(X,{users:p.value,class:"md:col-span-2"},null,8,["users"]),r("div",ne,[(i(!0),m(v,null,h(u.value,s=>(i(),m("div",{class:"overflow-x-auto",key:s.id},[r("div",ie,[a(Q,{users:y.value,roles:l.roles,guard:s,onDropped:z,onAsignRolesToGuard:R,onDeleteGuardRole:j,onDeleteGuard:B,onUnassignUser:N,unassignedUsers:p.value},null,8,["users","roles","guard","unassignedUsers"])])]))),128))])])):(i(),m("div",ue,e[10]||(e[10]=[r("p",{class:"text-xl font-semibold text-gray-500"},[d(" ⚠️ Por favor seleccione un comedor y asigne guardias para continuar. "),r("br"),d(" (La lista de guardias aparecerá aquí una vez se asignen). ")],-1)])))],8,oe),r("div",{class:"h-full",hidden:!g.value},[r("div",fe,[a(Y,{guards:u.value,users:y.value,cafeId:n.value.cafe,periods:A.value,onFetchCafeData:w},null,8,["guards","users","cafeId","periods"])])],8,de)])]),_:1})],64))}});export{rs as default};
