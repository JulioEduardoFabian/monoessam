import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-DtTiODGb.js";import{d as V,k as a,c as q,o as B,a as r,u as E,m as R,w as T,b as v,F as J,s as j}from"./app-DukjeBlQ.js";import{_ as z}from"./Alert.vue_vue_type_script_setup_true_lang-xLjoY9qH.js";import{_ as G}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-C_2ijJKo.js";import{_ as K}from"./SalesCard.vue_vue_type_script_setup_true_lang-DQp3HM9G.js";import{_ as L}from"./SalesHeader.vue_vue_type_script_setup_true_lang-DC3dxmD3.js";import{_ as M}from"./SalesTable.vue_vue_type_script_setup_true_lang-BSaiaJou.js";import"./utils-bRKmu4jq.js";import"./index-CwvBt_MV.js";import"./useForwardPropsEmits-Cqv6h3ID.js";import"./Primitive-CL45oa_y.js";import"./useForwardExpose-CZ7Yw5g_.js";import"./useFocusGuards-Bf0aebo0.js";import"./Teleport-4QoL-0pg.js";import"./VisuallyHidden-vyUhfAoA.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DCvF4rID.js";import"./Collection-DGETcuSV.js";import"./usePrimitiveElement-yyA821CA.js";import"./utils-BKQlEOSP.js";import"./useTypeahead-C2sDAK77.js";import"./RovingFocusGroup-DXkRqdXa.js";import"./createLucideIcon-CC9FwPDy.js";import"./x-B8fWZ8WI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-CFsguNdm.js";import"./user-ZbmkoQN5.js";import"./chevron-right-DBsyOGqS.js";import"./index-BKNcCfrT.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-Du0WfFxI.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-D-DwvwsP.js";import"./Card.vue_vue_type_script_setup_true_lang-R12XYbS_.js";import"./Input.vue_vue_type_script_setup_true_lang-B9zXiJL4.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DT3FKkOg.js";import"./nullish-CHIgUVhi.js";import"./check-CzugWCEF.js";import"./RovingFocusItem-DRMAjPtL.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-zCI9vBdP.js";import"./chevron-left-CnuKoMbZ.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-DG2OJ9YN.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-DVt7ayWY.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-C2UpTkMI.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-BDYj1EEE.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-ClYbLnC8.js";import"./PricesDialog.vue_vue_type_script_setup_true_lang-CbjcH05S.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-BoXu0h-1.js";import"./loader-circle-WaW3b9ev.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-DC9sHdzg.js";import"./TableCell.vue_vue_type_script_setup_true_lang-Ba6sTPjQ.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-cBLOEzq3.js";const Q={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},W={class:"grid auto-rows-min gap-4 md:grid-cols-2"},Le=V({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},sales:{}},setup(x){const p=a(null),F=x,s=a([]),A=e=>s.value.some(t=>t.serviceID===e.id),C=e=>{if(A(e)){s.value=s.value.filter(t=>t.serviceID!==e.id);return}s.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},U=e=>{I.value=e},f=a([...F.sales]),I=a([]),_=a(!1),h=a(""),S=a(""),l=a(""),c=a(!1),d=a(!1),n=(e,t)=>{var o;h.value=((o=t.response)==null?void 0:o.data.message)||t||"Ha ocurrido un error inesperado.",S.value=e,_.value=!0},y=()=>{c.value=!0},P=()=>{c.value=!1,d.value=!1},$=e=>{l.value=e},k=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else m(e)},g=a(0),D=a(0),w=a(0),H=e=>{g.value=e.cafe_id,D.value=e.sale_type_id,w.value=e.receipt_type_id},N=e=>{var t;d.value=!0,m((t=u.value)==null?void 0:t.dni)},u=a({}),b=a({}),m=e=>{const t=new FormData;if(t.append("cafe_id",g.value),t.append("sale_type_id",D.value),t.append("receipt_type",w.value),t.append("services",JSON.stringify(s.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",d.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}j.post("./sales",t).then(o=>{var i;o.data.dinner&&(u.value=o.data.dinner,b.value=o.data.dinner.subdealership,n("success",o.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),f.value=o.data.sales||[]),o.data.otherCafe&&y()}).catch(o=>{var i;console.error("Error fetching dinners:",o),n("error",o),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(B(),q(J,null,[r(E(R),{title:"Comensales"}),r(O,null,{default:T(()=>[r(z,{showAlert:_.value,type:S.value,description:h.value},null,8,["showAlert","type","description"]),v("div",Q,[t[0]||(t[0]=v("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),r(L,{cafes:e.cafes,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:U,onUpdateDate:$,onUpdateFormData:H,onAddServiceSelected:C},null,8,["cafes","services","receipt_types","sale_types"]),v("div",W,[r(K,{dinnerFound:u.value,subdealership:b.value,onHandleShowAlert:n,onShowDialog:y,onSaveSale:m,onUpdateDni:k,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),r(M,{sales:f.value},null,8,["sales"]),r(G,{showOtherUnitDialog:c.value,onHideDialog:P,onHandleDoublePriceSave:N},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{Le as default};
