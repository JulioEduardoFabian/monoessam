import{_ as $}from"./index-DylKbgOK.js";import{_ as S,a as U,b,c as V,d as D}from"./SelectValue.vue_vue_type_script_setup_true_lang-Dv8aRrXY.js";import{_ as A,a as C}from"./SelectLabel.vue_vue_type_script_setup_true_lang-UJsHp3P7.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-CwqqMFBv.js";import{d as P,k as c,q as T,s as H,c as m,o as u,a,u as t,m as O,w as o,b as i,e as d,F as g,l as _,g as G,t as M}from"./app-dDvgd9Af.js";import J from"./GuardAreaDroppable-CCbKs6ZD.js";import{_ as K}from"./GuardModal.vue_vue_type_script_setup_true_lang-0p3euM7f.js";import{_ as Q}from"./StaffSelectables.vue_vue_type_script_setup_true_lang-9e9VGKpf.js";import{_ as W}from"./TableHeadcount.vue_vue_type_script_setup_true_lang-Brb_QHfC.js";import{c as X}from"./createLucideIcon-TlbFHtr2.js";import"./Primitive-BbzxoJqv.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-2RVCMWya.js";import"./useForwardExpose-BPqkvDXh.js";import"./Teleport-qs3JaRkS.js";import"./chevron-down-D3pg9_Aq.js";import"./Collection-DaeZJO6B.js";import"./usePrimitiveElement-BS0WQcYh.js";import"./check-gh0o5Cwt.js";import"./PopperContent-3j3lJ9hu.js";import"./useTypeahead-r9uWB1q0.js";import"./utils-BNvyn1TN.js";import"./VisuallyHidden-ByvdFGTd.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DlEbKjfH.js";import"./RovingFocusGroup-CFOI6Vam.js";import"./DialogTitle-DXN8wJcz.js";import"./x-BuqpXMsT.js";import"./DialogDescription-gsC3Ecrj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-CU3g95oB.js";import"./user-BU2tL4gs.js";import"./chevron-right-BhpJH_PH.js";import"./GuardRolesDropzone-5XbQRQbM.js";import"./Draggable-B3LxDfB8.js";import"./GuardRolesModal-CNBJE60A.js";import"./index-CO1YvTs4.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang--3JDstpb.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-vOhR5Lq4.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-B4mxvxmS.js";import"./Input.vue_vue_type_script_setup_true_lang-6WBHo1iY.js";import"./plus-BmvW3Qft.js";import"./circle-alert-JZQ7yZxB.js";import"./trash-DeylDeKH.js";import"./Label.vue_vue_type_script_setup_true_lang-BQ49WoHZ.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-CyGOeat5.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=X("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Z={class:"flex h-full flex-1 flex-col gap-6 p-6"},ee={class:"flex w-full flex-row"},se={class:"flex gap-2"},ae=["hidden"],le={key:0,class:"grid h-full auto-rows-fr gap-6 md:grid-cols-8"},te={class:"md:col-span-6"},oe={class:"flex h-full gap-6"},ie={key:1,class:"flex h-full items-center justify-center p-10 text-center"},ne=["hidden"],re={class:"grid h-full"},ss=P({__name:"Index",props:{users:{},roles:{},permissions:{},areas:{},headquarters:{},mines:{},units:{}},setup(I){const h=I,n=c({mine:null,unit:null,cafe:null}),x=c([]),k=c([]),z=c([]),f=c([]),v=c(!1),p=c([]),y=c([]);T(n,l=>{if(l.mine!==null&&l.mine!==void 0){const s=h.mines.find(e=>String(e.id)===String(l.mine));x.value=s?s.units:[]}if(l.unit){const s=x.value.find(e=>e.id==l.unit);k.value=s?s.cafes:[]}l.cafe&&w(Number(l.cafe))},{deep:!0});const w=async l=>{try{const e=(await H.get(`/cafes/${l}`)).data;f.value=e.guards,p.value=e.users.unassigned,y.value=e.users.assigned,z.value=e.periods}catch(s){console.error("Error fetching cafe data:",s)}},L=l=>{p.value=p.value.filter(s=>s.id!==l),w(n.value.cafe)},R=l=>{console.log("updating guards",l),f.value=l},q=(l,s)=>{console.log(`Asignar roles al guardia ID ${l}:`,s);const e=f.value.find(r=>r.id===l);e&&s.forEach(r=>{const E={role:{id:r.id,guard_id:l,role_id:r.id,name:r.name}};e.assigned_roles.push(E)}),console.log(e)},B=(l,s)=>{const e=f.value.find(r=>r.id===l);console.log(s),e&&(e.assigned_roles=e.assigned_roles.filter(r=>r.id!==s))},N=l=>{if(k.value.find(e=>e.id==n.value.cafe)){const e=h.users.find(r=>r.id===l);e&&p.value.unshift(e)}},j=()=>{v.value=!v.value};return(l,s)=>(u(),m(g,null,[a(t(O),{title:"Headcount"}),a(F,null,{default:o(()=>[i("div",Z,[s[10]||(s[10]=i("div",{class:"flex"},[i("h1",{class:"text-2xl font-bold"},"Puestos")],-1)),s[11]||(s[11]=i("p",null,"Seleccione una mina, unidad y comedor para asignar guardias y roles",-1)),i("div",ee,[a($,{title:"Ver en lista",class:"cursor-pointer",onClick:s[0]||(s[0]=e=>j())},{default:o(()=>[a(t(Y))]),_:1})]),i("div",se,[a(t(S),{class:"w-full",modelValue:n.value.mine,"onUpdate:modelValue":s[1]||(s[1]=e=>n.value.mine=e)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona una mina"})]),_:1}),a(t(V),null,{default:o(()=>[a(t(A),null,{default:o(()=>[a(t(C),null,{default:o(()=>s[4]||(s[4]=[d("Minas")])),_:1}),(u(!0),m(g,null,_(h.mines,e=>(u(),G(t(D),{value:String(e.id),key:e.id},{default:o(()=>[d(M(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(S),{class:"w-full",modelValue:n.value.unit,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value.unit=e)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona una unidad minera"})]),_:1}),a(t(V),null,{default:o(()=>[a(t(A),null,{default:o(()=>[a(t(C),null,{default:o(()=>s[5]||(s[5]=[d("Unidades mineras")])),_:1}),(u(!0),m(g,null,_(x.value,e=>(u(),G(t(D),{value:e.id,key:e.id},{default:o(()=>[d(M(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(S),{class:"w-full",modelValue:n.value.cafe,"onUpdate:modelValue":s[3]||(s[3]=e=>n.value.cafe=e)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona un comedor"})]),_:1}),a(t(V),null,{default:o(()=>[a(t(A),null,{default:o(()=>[a(t(C),null,{default:o(()=>s[6]||(s[6]=[d("Comedores")])),_:1}),(u(!0),m(g,null,_(k.value,e=>(u(),G(t(D),{value:e.id,key:e.id},{default:o(()=>[d(M(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(K,{cafeId:n.value.cafe,onAssignGuards:R},null,8,["cafeId"]),a($,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>s[7]||(s[7]=[d(" Agregar roles ")])),_:1}),a($,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>s[8]||(s[8]=[d(" Agregar puesto ")])),_:1})]),i("div",{class:"h-full",hidden:v.value},[f.value&&f.value.length>0?(u(),m("div",le,[a(Q,{users:p.value,class:"md:col-span-2"},null,8,["users"]),i("div",te,[(u(!0),m(g,null,_(f.value,e=>(u(),m("div",{class:"overflow-x-auto",key:e.id},[i("div",oe,[a(J,{users:y.value,roles:l.roles,guard:e,onDropped:L,onAsignRolesToGuard:q,onDeleteGuardRole:B,onUnassignUser:N,unassignedUsers:p.value},null,8,["users","roles","guard","unassignedUsers"])])]))),128))])])):(u(),m("div",ie,s[9]||(s[9]=[i("p",{class:"text-xl font-semibold text-gray-500"},[d(" ⚠️ Por favor seleccione un comedor y asigne guardias para continuar. "),i("br"),d(" (La lista de guardias aparecerá aquí una vez se asignen). ")],-1)])))],8,ae),i("div",{class:"h-full",hidden:!v.value},[i("div",re,[a(W,{guards:f.value,users:y.value,cafeId:n.value.cafe,periods:z.value,onFetchCafeData:w},null,8,["guards","users","cafeId","periods"])])],8,ne)])]),_:1})],64))}});export{ss as default};
