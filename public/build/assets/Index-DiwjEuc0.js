import{_ as V}from"./AppLayout.vue_vue_type_script_setup_true_lang-B56r5EuT.js";import{d as q,k as a,c as B,o as E,a as r,u as R,m as T,w as J,b as v,F as j,s as z}from"./app-RAzx5sBv.js";import{_ as G}from"./Alert.vue_vue_type_script_setup_true_lang-BpepbNsx.js";import{_ as K}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-cibgGVmt.js";import{_ as L}from"./SalesCard.vue_vue_type_script_setup_true_lang-BRIRIBAe.js";import{_ as M}from"./SalesHeader.vue_vue_type_script_setup_true_lang-BhMTh4ow.js";import{_ as Q}from"./SalesTable.vue_vue_type_script_setup_true_lang-Bmbu9ZUE.js";import"./utils-bRKmu4jq.js";import"./index-BHhyCWcG.js";import"./useForwardPropsEmits-CDRXcYP-.js";import"./Primitive-D9tzbjnl.js";import"./useForwardExpose-CBCrBFH8.js";import"./useFocusGuards-lxMXwRKx.js";import"./Teleport-IZsS0bLf.js";import"./VisuallyHidden-ClzSWsUg.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BcTUZi__.js";import"./Collection-DFR_xu9H.js";import"./usePrimitiveElement-CH0xUD5m.js";import"./utils-B_L_r_s6.js";import"./useTypeahead-D1yNrAZ2.js";import"./RovingFocusGroup-B7hq8uwQ.js";import"./createLucideIcon-B1dBweFY.js";import"./x-CR5BlNGy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-opWuv5c3.js";import"./user-BDBu_dzX.js";import"./chevron-right-CUCY46d9.js";import"./index-CEUHOntJ.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-C7Qtm9Dr.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-DU0k_xRj.js";import"./Card.vue_vue_type_script_setup_true_lang-DhRHKf1l.js";import"./Input.vue_vue_type_script_setup_true_lang-BI8mnpxV.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Nk-QbAIW.js";import"./nullish-CHIgUVhi.js";import"./check-CZUw54I4.js";import"./RovingFocusItem-D7Qm4khQ.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-CLwUZUtk.js";import"./chevron-left-CgFKmvk_.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-DHLEmLWn.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-B_UymE6U.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-DoplLtH7.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-CILMbhxD.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-CFhkQyfU.js";import"./PricesDialog.vue_vue_type_script_setup_true_lang--ntxunN1.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-BoNEtKlv.js";import"./loader-circle-DNS2r-EA.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-CbMV-O4L.js";import"./TableCell.vue_vue_type_script_setup_true_lang-CknelFoL.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-Degltgeh.js";const W={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},X={class:"grid auto-rows-min gap-4 md:grid-cols-2"},Me=q({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},sales:{}},setup(F){const p=a(null),A=F,s=a([]),C=e=>s.value.some(t=>t.serviceID===e.id),U=e=>{if(C(e)){s.value=s.value.filter(t=>t.serviceID!==e.id);return}s.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},I=e=>{P.value=e},f=a([...A.sales]),P=a([]),_=a(!1),h=a(""),S=a(""),l=a(""),c=a(!1),d=a(!1),n=(e,t)=>{var o;h.value=((o=t.response)==null?void 0:o.data.message)||t||"Ha ocurrido un error inesperado.",S.value=e,_.value=!0},u=a(""),y=()=>{c.value=!0},$=()=>{c.value=!1,d.value=!1},k=e=>{l.value=e},H=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else m(e)},g=a(0),D=a(0),w=a(0),N=e=>{g.value=e.cafe_id,D.value=e.sale_type_id,w.value=e.receipt_type_id},O=e=>{d.value=!0,m(u.value)},b=a({}),x=a({}),m=e=>{u.value=e;const t=new FormData;if(t.append("cafe_id",g.value),t.append("sale_type_id",D.value),t.append("receipt_type",w.value),t.append("services",JSON.stringify(s.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",d.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}z.post("./sales",t).then(o=>{var i;o.data.dinner&&(b.value=o.data.dinner,x.value=o.data.dinner.subdealership,n("success",o.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),f.value=o.data.sales||[]),o.data.otherCafe&&(console.log(u.value),y())}).catch(o=>{var i;console.error("Error fetching dinners:",o),n("error",o),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(E(),B(j,null,[r(R(T),{title:"Comensales"}),r(V,null,{default:J(()=>[r(G,{showAlert:_.value,type:S.value,description:h.value},null,8,["showAlert","type","description"]),v("div",W,[t[0]||(t[0]=v("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),r(M,{cafes:e.cafes,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:I,onUpdateDate:k,onUpdateFormData:N,onAddServiceSelected:U},null,8,["cafes","services","receipt_types","sale_types"]),v("div",X,[r(L,{dinnerFound:b.value,subdealership:x.value,onHandleShowAlert:n,onShowDialog:y,onSaveSale:m,onUpdateDni:H,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),r(Q,{sales:f.value},null,8,["sales"]),r(K,{showOtherUnitDialog:c.value,onHideDialog:$,onHandleDoublePriceSave:O},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{Me as default};
