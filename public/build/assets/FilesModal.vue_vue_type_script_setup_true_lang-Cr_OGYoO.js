import{b as se,_ as oe,a as ne}from"./index-CeqRlwFU.js";import{_ as y}from"./index-BJFMstxI.js";import{_ as le}from"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-BZGI3xlB.js";import{_ as ie,a as re,b as ce,c as de}from"./DialogTitle.vue_vue_type_script_setup_true_lang-yXjI7TAs.js";import{_ as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CSaKwPtC.js";import{_ as pe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BFhudyp4.js";import{d as me,l as fe,j as g,C as L,y as xe,g as O,o as r,w as c,a as n,u as i,b as t,e as f,i as h,c as d,t as p,F as q,p as B,n as P}from"./app-iAuqwefD.js";import{F as $}from"./file-C_ol4k67.js";import{c as R}from"./createLucideIcon-B0VpfLua.js";import{C as U}from"./calendar-Be8c5UhG.js";import{X as ve}from"./x-CEB3XjGB.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=R("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=R("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ge={class:"flex-1 space-y-4 overflow-y-auto pr-2"},he={class:"rounded-lg bg-blue-50 p-4"},be={class:"flex items-center space-x-3"},ye={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100"},ke={class:"font-medium text-gray-900"},we={key:1,class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},Ee={class:"mb-3 font-medium text-gray-900"},Ce={class:"flex items-center space-x-3"},Se={class:"space-y-2"},je={class:"space-y-6"},ze={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},$e={class:"mb-3 flex items-center justify-between"},De={class:"flex items-center space-x-3"},Fe={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100"},Ve={class:"text-sm font-medium"},Me={class:"font-medium text-gray-900"},Ne={class:"flex items-center space-x-2 text-sm text-gray-500"},Ie={key:0,class:"inline-flex items-center text-amber-600"},Ae={key:0},Le={key:1,class:"inline-flex items-center"},Oe=["accept","data-file-type","onChange","disabled"],qe={key:0,class:"space-y-2"},Be={class:"flex items-center justify-between"},Pe={class:"flex items-center space-x-3"},Ue={class:"flex items-center space-x-2"},Ge={class:"text-sm font-medium text-gray-700"},Re={key:0,class:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"},He={class:"mt-1 space-y-1 text-xs text-gray-500"},Je={class:"flex items-center space-x-2"},Xe={key:0},Ke={key:1,class:"inline-flex items-center"},We={class:"flex items-center space-x-1"},Qe={key:0,class:"mr-2"},Ye=["value","onChange","min"],Ze={key:1,class:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center"},Te={class:"flex w-full items-center justify-between"},et={class:"text-sm text-gray-500"},tt={class:"font-medium"},mt=me({__name:"FilesModal",props:{staff:{type:Object,required:!0}},emits:["update-files"],setup(D,{emit:H}){var M;const b=D,J=fe(),C=g(!1),m=g(!1),x=g(""),E=g(null),v=g(null),k=g(""),_=g([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1},{label:"Certificado Ãšnico Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"DNI escaneado",key:"dni_escaneado",accept:".jpg,.jpeg,.png",maxSize:5,hasExpiration:!0},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de vacunaciÃ³n contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0}]),X=L({staff_id:b.staff.id,files:[],user_id:(M=J.props.auth.user)==null?void 0:M.id}),K=(s,e,a)=>{var N,I,A;const o=s.target;if(!o.files||o.files.length===0)return;const l=o.files[0],u=_.value.find(w=>w.label===e);if(!u)return;if(l.size>u.maxSize*1024*1024){m.value=!0,x.value=`El archivo excede el tamaÃ±o mÃ¡ximo de ${u.maxSize}MB`,o.value="";return}const j=u.accept.split(",").map(w=>w.trim().toLowerCase()),z="."+((N=l.name.split(".").pop())==null?void 0:N.toLowerCase());if(!j.includes(z)){m.value=!0,x.value=`Tipo de archivo no vÃ¡lido. Formatos aceptados: ${u.accept}`,o.value="";return}if(E.value=e,u.hasExpiration&&a!==void 0){v.value=a;return}const ae=(A=(I=b.staff.staff_files)==null?void 0:I.find(w=>w.file_type==e))==null?void 0:A.id;F(l,{fileTypeKey:e,fileFoundId:ae}),o.value=""},W=()=>{if(v.value===null||!k.value){m.value=!0,x.value="Debe seleccionar una fecha de expiraciÃ³n";return}const s=_.value[v.value].key;_.value[v.value].label;const e=document.querySelector(`input[data-file-type="${s}"]`);if(!e||!e.files||e.files.length===0){m.value=!0,x.value="No se encontrÃ³ el archivo";return}const a=k.value,o=a.year,l=String(a.month).padStart(2,"0"),u=String(a.day).padStart(2,"0"),j=`${o}-${l}-${u}`,z=e.files[0];F(z,{},j),v.value=null,k.value="",e.value=""},F=(s,e,a)=>{console.log(a),L({file:s,fileTypeKey:e.fileTypeKey,expirationDate:a,fileId:e.fileFoundId??0,staffId:b.staff.id}).post(route("staff.upload-file"),{forceFormData:!0,preserveState:!0,onSuccess:l=>{alert("Archivo actualizado correctamente")},onError:l=>{m.value=!0,x.value="Error en la conexiÃ³n",console.error(error)}})},Q=s=>{confirm("Â¿EstÃ¡ seguro de eliminar este archivo?")&&X.delete(route("staff.delete-file",s),{onSuccess:()=>{alert("Archivo eliminado correctamente")},onError:e=>{m.value=!0,x.value="Error en la conexiÃ³n",console.error(e)}})},Y=s=>{window.open("/storage/"+s.file_path,"_blank")},Z=(s,e)=>{var a;fetch(route("staff.update-file-expiration",s),{method:"PUT",headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({expiration_date:e})}).then(o=>o.json()).then(o=>{o.success?T("update-files"):(m.value=!0,x.value=o.message||"Error al actualizar la fecha")}).catch(o=>{m.value=!0,x.value="Error en la conexiÃ³n",console.error(o)})},S=xe(()=>{const s={};return _.value.forEach(e=>{s[e.label]=[]}),b.staff.staff_files&&b.staff.staff_files.forEach(e=>{const a=_.value.find(o=>o.label===e.file_type);a&&s[a.label].push(e)}),s}),T=H,ee=s=>new Date(s).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),te=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",V=s=>s?new Date(s)<new Date:!1;return(s,e)=>(r(),O(i(de),{open:C.value,"onUpdate:open":e[4]||(e[4]=a=>C.value=a)},{default:c(()=>[n(i(pe),{"as-child":""},{default:c(()=>[n(y,{variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:c(()=>[n(i($),{class:"h-4 w-4"})]),_:1})]),_:1}),n(i(ie),{class:"flex max-h-[90vh] w-full flex-col sm:max-w-[900px]"},{default:c(()=>[n(i(re),{class:"shrink-0 border-b pb-3"},{default:c(()=>[n(i(ce),null,{default:c(()=>e[5]||(e[5]=[f("GestiÃ³n de Documentos del Personal")])),_:1})]),_:1}),t("div",ge,[t("div",he,[t("div",be,[t("div",ye,[n(i($),{class:"h-5 w-5 text-blue-600"})]),t("div",null,[t("h3",ke,p(D.staff.name),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-600"},"GestiÃ³n de documentos y archivos",-1))])])]),e[16]||(e[16]=t("div",{class:"rounded-lg border border-amber-200 bg-amber-50 p-4"},[t("div",{class:"flex items-start"},[t("div",{class:"mt-0.5 mr-3"},[t("div",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-600"},"!")]),t("div",null,[t("h4",{class:"text-sm font-medium text-amber-800"},"AtenciÃ³n"),t("p",{class:"mt-1 text-sm text-amber-700"}," AsegÃºrese de que los archivos sean legibles (PDF, DOC, JPG, PNG) y que pesen menos de 10MB. Los documentos marcados con ðŸ“… requieren fecha de expiraciÃ³n. ")])])],-1)),m.value?(r(),O(i(se),{key:0,variant:"destructive",class:"relative"},{default:c(()=>[t("button",{class:"absolute top-3 right-3 text-sm",onClick:e[0]||(e[0]=a=>m.value=!1)},"âœ•"),n(i(oe),null,{default:c(()=>e[7]||(e[7]=[f("Error")])),_:1}),n(i(ne),null,{default:c(()=>[f(p(x.value),1)]),_:1})]),_:1})):h("",!0),v.value!==null?(r(),d("div",we,[t("h4",Ee,"Seleccionar fecha de expiraciÃ³n para "+p(_.value[v.value].label),1),t("div",Ce,[n(i(le),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),class:"rounded-md border","min-date":new Date},null,8,["modelValue","min-date"]),t("div",Se,[n(y,{onClick:W,class:"w-full"},{default:c(()=>[n(i(G),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=f(" Subir con fecha "))]),_:1}),n(y,{variant:"outline",onClick:e[2]||(e[2]=a=>v.value=null),class:"w-full"},{default:c(()=>e[9]||(e[9]=[f(" Cancelar ")])),_:1})])])])):h("",!0),t("div",je,[(r(!0),d(q,null,B(_.value,(a,o)=>(r(),d("div",{key:o,class:"space-y-3"},[t("div",ze,[t("div",$e,[t("div",De,[t("div",Fe,[t("span",Ve,p(o+1),1)]),t("div",null,[t("h4",Me,p(a.label),1),t("div",Ne,[t("span",null,"Formatos: "+p(a.accept.replace(/\./g,"").toUpperCase()),1),e[11]||(e[11]=t("span",null,"â€¢",-1)),t("span",null,"MÃ¡x: "+p(a.maxSize)+"MB",1),a.hasExpiration?(r(),d("span",Ie,[n(i(U),{class:"ml-2 h-4 w-4"}),e[10]||(e[10]=t("span",{class:"ml-1"},"Requiere fecha",-1))])):h("",!0)])])]),t("label",{class:P(["cursor-pointer rounded-md px-4 py-2 text-sm font-medium transition-colors",E.value===a.key?"cursor-not-allowed bg-blue-400 text-white":"bg-blue-600 text-white hover:bg-blue-700"])},[E.value===a.key?(r(),d("span",Ae,e[12]||(e[12]=[t("span",{class:"inline-flex items-center"},[t("svg",{class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),f(" Subiendo... ")],-1)]))):(r(),d("span",Le,[n(i(G),{class:"mr-2 h-4 w-4"}),e[13]||(e[13]=f(" Subir "))])),t("input",{type:"file",accept:a.accept,class:"hidden","data-file-type":a.key,onChange:l=>K(l,a.label,o),disabled:E.value!==null},null,40,Oe)],2)]),S.value[a.label]&&S.value[a.label].length>0?(r(),d("div",qe,[(r(!0),d(q,null,B(S.value[a.label],l=>(r(),d("div",{key:l.id,class:P(["rounded-lg border p-3 transition-colors",V(l.expiration_date)?"border-red-200 bg-red-50":"border-green-200 bg-green-50"])},[t("div",Be,[t("div",Pe,[t("div",null,[t("div",Ue,[t("p",Ge,p(l.path),1),V(l.expiration_date)?(r(),d("span",Re," VENCIDO ")):h("",!0)]),t("div",He,[t("p",null,"Subido: "+p(ee(l.created_at)),1),t("div",Je,[l.user_name?(r(),d("span",Xe,"Por: "+p(l.user_name),1)):h("",!0),a.hasExpiration?(r(),d("span",Ke,[n(i(U),{class:"mr-1 h-3 w-3"}),f(" Vence: "+p(te(l.expiration_date)),1)])):h("",!0)])])])]),t("div",We,[a.hasExpiration?(r(),d("div",Qe,[t("input",{type:"date",value:l.expiration_date||"",onChange:u=>Z(l.id,u.target.value),class:"rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,40,Ye)])):h("",!0),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-blue-600 hover:bg-blue-100",onClick:u=>Y(l),title:"Vista previa"},{default:c(()=>[n(i(_e),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600 hover:bg-red-100",onClick:u=>Q(l.id),title:"Eliminar"},{default:c(()=>[n(i(ve),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])],2))),128))])):(r(),d("div",Ze,[n(i($),{class:"mx-auto h-8 w-8 text-gray-400"}),e[14]||(e[14]=t("p",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay archivos subidos",-1)),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500"},'Haz clic en "Subir" para agregar un documento',-1))]))])]))),128))])]),n(i(ue),{class:"border-t pt-4"},{default:c(()=>{var a;return[t("div",Te,[t("div",et,[t("span",tt,p(((a=b.staff.staff_files)==null?void 0:a.length)||0),1),e[17]||(e[17]=f(" archivos en total "))]),n(y,{variant:"outline",onClick:e[3]||(e[3]=o=>C.value=!1)},{default:c(()=>e[18]||(e[18]=[f("Cerrar")])),_:1})])]}),_:1})]),_:1})]),_:1},8,["open"]))}});export{mt as _};
