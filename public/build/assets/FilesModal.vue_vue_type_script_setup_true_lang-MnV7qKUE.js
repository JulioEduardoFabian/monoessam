import{b as se,_ as oe,a as ne}from"./index-ZQLnKzgN.js";import{_ as h}from"./index-DVOfqkhy.js";import{_ as le}from"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-xoNb_nDI.js";import{_ as ie,a as re,b as ce,c as de}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C2U1RBnW.js";import{_ as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BRTBSy0Q.js";import{_ as pe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-C1DR1VTJ.js";import{d as fe,l as me,j as _,C as L,y as ve,g as O,o as r,w as c,a as o,u as i,b as t,e as v,i as g,c as d,t as p,F as A,p as B,n as P}from"./app-CPxO9Yet.js";import{F as j}from"./file-R_sG-NKF.js";import{c as z}from"./createLucideIcon-DuZDKriR.js";import{C as U}from"./calendar-BIl0q6Qc.js";import{X as xe}from"./x-BP_P-E-Q.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=z("DownloadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=z("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=z("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ge={class:"flex-1 space-y-4 overflow-y-auto pr-2"},be={class:"rounded-lg bg-blue-50 p-4"},ye={class:"flex items-center space-x-3"},ke={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100"},we={class:"font-medium text-gray-900"},Ee={key:1,class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},Ce={class:"mb-3 font-medium text-gray-900"},Se={class:"flex items-center space-x-3"},je={class:"space-y-2"},ze={class:"space-y-6"},De={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},Fe={class:"mb-3 flex items-center justify-between"},$e={class:"flex items-center space-x-3"},Ve={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100"},Me={class:"text-sm font-medium"},Ne={class:"font-medium text-gray-900"},qe={class:"flex items-center space-x-2 text-sm text-gray-500"},Ie={key:0,class:"inline-flex items-center text-amber-600"},Le={key:0},Oe={key:1,class:"inline-flex items-center"},Ae=["accept","data-file-type","onChange","disabled"],Be={key:0,class:"space-y-2"},Pe={class:"flex items-center justify-between"},Ue={class:"flex items-center space-x-3"},Re={class:"flex items-center space-x-2"},Ge={class:"text-sm font-medium text-gray-700"},He={key:0,class:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"},Xe={class:"mt-1 space-y-1 text-xs text-gray-500"},Je={class:"flex items-center space-x-2"},Ke={key:0},Te={key:1,class:"inline-flex items-center"},We={class:"flex items-center space-x-1"},Qe={key:0,class:"mr-2"},Ye=["value","onChange","min"],Ze={key:1,class:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center"},et={class:"flex w-full items-center justify-between"},tt={class:"text-sm text-gray-500"},at={class:"font-medium"},mt=fe({__name:"FilesModal",props:{staff:{type:Object,required:!0}},emits:["update-files"],setup(D,{emit:G}){var M;const y=D,H=me(),C=_(!1),u=_(!1),m=_(""),E=_(null),x=_(null),k=_(""),b=_([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1},{label:"Certificado Ãšnico Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"DNI escaneado",key:"dni_escaneado",accept:".jpg,.jpeg,.png",maxSize:5,hasExpiration:!0},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"CarnÃ© de vacunaciÃ³n contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0}]);L({staff_id:y.staff.id,files:[],user_id:(M=H.props.auth.user)==null?void 0:M.id});const X=(s,e,a)=>{var N,q,I;const n=s.target;if(!n.files||n.files.length===0)return;const l=n.files[0],f=b.value.find(w=>w.label===e);if(!f)return;if(l.size>f.maxSize*1024*1024){u.value=!0,m.value=`El archivo excede el tamaÃ±o mÃ¡ximo de ${f.maxSize}MB`,n.value="";return}const ee=f.accept.split(",").map(w=>w.trim().toLowerCase()),te="."+((N=l.name.split(".").pop())==null?void 0:N.toLowerCase());if(!ee.includes(te)){u.value=!0,m.value=`Tipo de archivo no vÃ¡lido. Formatos aceptados: ${f.accept}`,n.value="";return}if(E.value=e,f.hasExpiration&&a!==void 0){x.value=a;return}const ae=(I=(q=y.staff.staff_files)==null?void 0:q.find(w=>w.file_type==e))==null?void 0:I.id;F(l,{fileTypeKey:e,fileFoundId:ae}),n.value=""},J=()=>{if(x.value===null||!k.value){u.value=!0,m.value="Debe seleccionar una fecha de expiraciÃ³n";return}const s=b.value[x.value].key,e=document.querySelector(`input[data-file-type="${s}"]`);if(!e||!e.files||e.files.length===0){u.value=!0,m.value="No se encontrÃ³ el archivo";return}const a=e.files[0];F(a,{fileTypeKey:s},k.value),x.value=null,k.value="",e.value=""},F=(s,e,a)=>{L({file:s,fileTypeKey:e.fileTypeKey,expirationDate:a,fileId:e.fileFoundId}).post(route("staff.upload-file"),{forceFormData:!0,preserveState:!0,onSuccess:l=>{alert("Archivo actualizado correctamente")},onError:l=>{u.value=!0,m.value="Error en la conexiÃ³n",console.error(error)}})},K=s=>{var e;confirm("Â¿EstÃ¡ seguro de eliminar este archivo?")&&fetch(route("staff.delete-file",s),{method:"DELETE",headers:{"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{a.success?($("update-files"),u.value=!1):(u.value=!0,m.value=a.message||"Error al eliminar el archivo")}).catch(a=>{u.value=!0,m.value="Error en la conexiÃ³n",console.error(a)})},T=s=>{window.open(route("staff.download-file",s.id),"_blank")},W=s=>{window.open(route("staff.view-file",s.id),"_blank")},Q=(s,e)=>{var a;fetch(route("staff.update-file-expiration",s),{method:"PUT",headers:{"X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({expiration_date:e})}).then(n=>n.json()).then(n=>{n.success?$("update-files"):(u.value=!0,m.value=n.message||"Error al actualizar la fecha")}).catch(n=>{u.value=!0,m.value="Error en la conexiÃ³n",console.error(n)})},S=ve(()=>{const s={};return b.value.forEach(e=>{s[e.label]=[]}),y.staff.staff_files&&y.staff.staff_files.forEach(e=>{const a=b.value.find(n=>n.label===e.file_type);a&&s[a.label].push(e)}),s}),$=G,Y=s=>new Date(s).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Z=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",V=s=>s?new Date(s)<new Date:!1;return(s,e)=>(r(),O(i(de),{open:C.value,"onUpdate:open":e[4]||(e[4]=a=>C.value=a)},{default:c(()=>[o(i(pe),{"as-child":""},{default:c(()=>[o(h,{variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:c(()=>[o(i(j),{class:"h-4 w-4"})]),_:1})]),_:1}),o(i(ie),{class:"flex max-h-[90vh] w-full flex-col sm:max-w-[900px]"},{default:c(()=>[o(i(re),{class:"shrink-0 border-b pb-3"},{default:c(()=>[o(i(ce),null,{default:c(()=>e[5]||(e[5]=[v("GestiÃ³n de Documentos del Personal")])),_:1})]),_:1}),t("div",ge,[t("div",be,[t("div",ye,[t("div",ke,[o(i(j),{class:"h-5 w-5 text-blue-600"})]),t("div",null,[t("h3",we,p(D.staff.name),1),e[6]||(e[6]=t("p",{class:"text-sm text-gray-600"},"GestiÃ³n de documentos y archivos",-1))])])]),e[16]||(e[16]=t("div",{class:"rounded-lg border border-amber-200 bg-amber-50 p-4"},[t("div",{class:"flex items-start"},[t("div",{class:"mt-0.5 mr-3"},[t("div",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-600"},"!")]),t("div",null,[t("h4",{class:"text-sm font-medium text-amber-800"},"AtenciÃ³n"),t("p",{class:"mt-1 text-sm text-amber-700"}," AsegÃºrese de que los archivos sean legibles (PDF, DOC, JPG, PNG) y que pesen menos de 10MB. Los documentos marcados con ðŸ“… requieren fecha de expiraciÃ³n. ")])])],-1)),u.value?(r(),O(i(se),{key:0,variant:"destructive",class:"relative"},{default:c(()=>[t("button",{class:"absolute top-3 right-3 text-sm",onClick:e[0]||(e[0]=a=>u.value=!1)},"âœ•"),o(i(oe),null,{default:c(()=>e[7]||(e[7]=[v("Error")])),_:1}),o(i(ne),null,{default:c(()=>[v(p(m.value),1)]),_:1})]),_:1})):g("",!0),x.value!==null?(r(),d("div",Ee,[t("h4",Ce,"Seleccionar fecha de expiraciÃ³n para "+p(b.value[x.value].label),1),t("div",Se,[o(i(le),{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),class:"rounded-md border","min-date":new Date},null,8,["modelValue","min-date"]),t("div",je,[o(h,{onClick:J,class:"w-full"},{default:c(()=>[o(i(R),{class:"mr-2 h-4 w-4"}),e[8]||(e[8]=v(" Subir con fecha "))]),_:1}),o(h,{variant:"outline",onClick:e[2]||(e[2]=a=>x.value=null),class:"w-full"},{default:c(()=>e[9]||(e[9]=[v(" Cancelar ")])),_:1})])])])):g("",!0),t("div",ze,[(r(!0),d(A,null,B(b.value,(a,n)=>(r(),d("div",{key:n,class:"space-y-3"},[t("div",De,[t("div",Fe,[t("div",$e,[t("div",Ve,[t("span",Me,p(n+1),1)]),t("div",null,[t("h4",Ne,p(a.label),1),t("div",qe,[t("span",null,"Formatos: "+p(a.accept.replace(/\./g,"").toUpperCase()),1),e[11]||(e[11]=t("span",null,"â€¢",-1)),t("span",null,"MÃ¡x: "+p(a.maxSize)+"MB",1),a.hasExpiration?(r(),d("span",Ie,[o(i(U),{class:"ml-2 h-4 w-4"}),e[10]||(e[10]=t("span",{class:"ml-1"},"Requiere fecha",-1))])):g("",!0)])])]),t("label",{class:P(["cursor-pointer rounded-md px-4 py-2 text-sm font-medium transition-colors",E.value===a.key?"cursor-not-allowed bg-blue-400 text-white":"bg-blue-600 text-white hover:bg-blue-700"])},[E.value===a.key?(r(),d("span",Le,e[12]||(e[12]=[t("span",{class:"inline-flex items-center"},[t("svg",{class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),v(" Subiendo... ")],-1)]))):(r(),d("span",Oe,[o(i(R),{class:"mr-2 h-4 w-4"}),e[13]||(e[13]=v(" Subir "))])),t("input",{type:"file",accept:a.accept,class:"hidden","data-file-type":a.key,onChange:l=>X(l,a.label,n),disabled:E.value!==null},null,40,Ae)],2)]),S.value[a.label]&&S.value[a.label].length>0?(r(),d("div",Be,[(r(!0),d(A,null,B(S.value[a.label],l=>(r(),d("div",{key:l.id,class:P(["rounded-lg border p-3 transition-colors",V(l.expiration_date)?"border-red-200 bg-red-50":"border-green-200 bg-green-50"])},[t("div",Pe,[t("div",Ue,[t("div",null,[t("div",Re,[t("p",Ge,p(l.path),1),V(l.expiration_date)?(r(),d("span",He," VENCIDO ")):g("",!0)]),t("div",Xe,[t("p",null,"Subido: "+p(Y(l.created_at)),1),t("div",Je,[l.user_name?(r(),d("span",Ke,"Por: "+p(l.user_name),1)):g("",!0),a.hasExpiration?(r(),d("span",Te,[o(i(U),{class:"mr-1 h-3 w-3"}),v(" Vence: "+p(Z(l.expiration_date)),1)])):g("",!0)])])])]),t("div",We,[a.hasExpiration?(r(),d("div",Qe,[t("input",{type:"date",value:l.expiration_date||"",onChange:f=>Q(l.id,f.target.value),class:"rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,40,Ye)])):g("",!0),o(h,{variant:"ghost",size:"icon",class:"h-8 w-8 text-blue-600 hover:bg-blue-100",onClick:f=>W(l),title:"Vista previa"},{default:c(()=>[o(i(_e),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(h,{variant:"ghost",size:"icon",class:"h-8 w-8 text-green-600 hover:bg-green-100",onClick:f=>T(l),title:"Descargar"},{default:c(()=>[o(i(he),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(h,{variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600 hover:bg-red-100",onClick:f=>K(l.id),title:"Eliminar"},{default:c(()=>[o(i(xe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])],2))),128))])):(r(),d("div",Ze,[o(i(j),{class:"mx-auto h-8 w-8 text-gray-400"}),e[14]||(e[14]=t("p",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay archivos subidos",-1)),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500"},'Haz clic en "Subir" para agregar un documento',-1))]))])]))),128))])]),o(i(ue),{class:"border-t pt-4"},{default:c(()=>{var a;return[t("div",et,[t("div",tt,[t("span",at,p(((a=y.staff.staff_files)==null?void 0:a.length)||0),1),e[17]||(e[17]=v(" archivos en total "))]),o(h,{variant:"outline",onClick:e[3]||(e[3]=n=>C.value=!1)},{default:c(()=>e[18]||(e[18]=[v("Cerrar")])),_:1})])]}),_:1})]),_:1})]),_:1},8,["open"]))}});export{mt as _};
