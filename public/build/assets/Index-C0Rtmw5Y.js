import{_ as T}from"./AppLayout.vue_vue_type_script_setup_true_lang-CwqqMFBv.js";import{d as E,k as a,n as R,c as J,o as x,a as s,u as A,m as j,w as z,b as f,g as G,i as K,F as L,s as M}from"./app-dDvgd9Af.js";import{_ as Q}from"./SubdealershipsDialog.vue_vue_type_script_setup_true_lang-lQkEDqyv.js";import{_ as W}from"./Alert.vue_vue_type_script_setup_true_lang-BdQq7CWg.js";import{_ as X}from"./OtherUnitDialog.vue_vue_type_script_setup_true_lang-BgbpYfag.js";import{_ as Y}from"./SalesCard.vue_vue_type_script_setup_true_lang-CYdhIQhD.js";import{_ as Z}from"./SalesHeader.vue_vue_type_script_setup_true_lang-Bj57PSd8.js";import ee from"./SalesTable-CjkWvFUi.js";import"./utils-bRKmu4jq.js";import"./Presence-2RVCMWya.js";import"./Primitive-BbzxoJqv.js";import"./useForwardExpose-BPqkvDXh.js";import"./PopperContent-3j3lJ9hu.js";import"./Teleport-qs3JaRkS.js";import"./VisuallyHidden-ByvdFGTd.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DlEbKjfH.js";import"./utils-BNvyn1TN.js";import"./useTypeahead-r9uWB1q0.js";import"./RovingFocusGroup-CFOI6Vam.js";import"./usePrimitiveElement-BS0WQcYh.js";import"./Collection-DaeZJO6B.js";import"./createLucideIcon-TlbFHtr2.js";import"./DialogTitle-DXN8wJcz.js";import"./x-BuqpXMsT.js";import"./DialogDescription-gsC3Ecrj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./building-2-CU3g95oB.js";import"./user-BU2tL4gs.js";import"./chevron-right-BhpJH_PH.js";import"./index-DylKbgOK.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang--3JDstpb.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-vOhR5Lq4.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-B4mxvxmS.js";import"./Input.vue_vue_type_script_setup_true_lang-6WBHo1iY.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Dv8aRrXY.js";import"./chevron-down-D3pg9_Aq.js";import"./check-gh0o5Cwt.js";import"./SelectLabel.vue_vue_type_script_setup_true_lang-UJsHp3P7.js";import"./circle-plus-f9PKlEUk.js";import"./index-BjafKjWc.js";import"./Card.vue_vue_type_script_setup_true_lang--1hqoAQN.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CRgWsSCA.js";import"./RovingFocusItem-7Wdv25c6.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-Cxm84XwZ.js";import"./chevron-left-D6Nd6a8p.js";import"./CalendarPrevButton.vue_vue_type_script_setup_true_lang-B1-qgRbI.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-ojfJ45u4.js";import"./DinnersTable.vue_vue_type_script_setup_true_lang-Bt0Sjfdw.js";import"./ExcelDialog.vue_vue_type_script_setup_true_lang-D-Q45at3.js";import"./NewDinnerDialog.vue_vue_type_script_setup_true_lang-CM5jncgh.js";import"./user-plus-Bqa-2tZc.js";import"./ReportDialog.vue_vue_type_script_setup_true_lang-DQ3MEF5g.js";import"./loader-circle-D_TWQKME.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-CyGOeat5.js";import"./TableCaption.vue_vue_type_script_setup_true_lang-CJZ9jso6.js";import"./SaleDetailsPopover.vue_vue_type_script_setup_true_lang-CnSX-UrP.js";const te={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ae={class:"grid auto-rows-min gap-4 md:grid-cols-2"},lt=E({__name:"Index",props:{dinners:{},services:{},units:{},cafes:{},sale_types:{},receipt_types:{},todaySales:{},subdealerships:{},dealerships:{}},setup(U){const p=a(null),I=R().props.auth.permissions,h=U,r=a([]),k=e=>r.value.some(t=>t.serviceID===e.id),P=e=>{if(k(e)){r.value=r.value.filter(t=>t.serviceID!==e.id);return}r.value.push({serviceID:e.id,quantity:e.quantity||1,price:e.quantity*e.pivot.price,code:e.code,name:e.name,unit_price:e.pivot.price,service_type:e.type})},$=(e,t)=>{N.value=e,d.value=t},d=a([...h.todaySales.data]),N=a([]),_=a(!1),S=a(""),y=a(""),l=a(""),c=a(!1),u=a(!1),n=(e,t)=>{var o;S.value=((o=t.response)==null?void 0:o.data.message)||t||"Ha ocurrido un error inesperado.",y.value=e,_.value=!0},m=a(""),g=()=>{c.value=!0},V=()=>{c.value=!1,u.value=!1},B=e=>{l.value=e},H=e=>{if(!e.trim()||e.length!=8){alert("Por favor, ingrese un DNI válido.");return}else v(e)},D=a(0),w=a(0),b=a(0),O=e=>{D.value=e.cafe_id,w.value=e.sale_type_id,b.value=e.receipt_type_id},q=e=>{u.value=!0,v(m.value)},F=a({}),C=a({}),v=e=>{m.value=e;const t=new FormData;if(t.append("cafe_id",D.value),t.append("sale_type_id",w.value),t.append("receipt_type",b.value),t.append("services",JSON.stringify(r.value)),t.append("dni",e),t.append("date",l.value),t.append("double_price",u.value),l.value==null||l.value==""){n("error","Por favor, seleccione una fecha válida.");return}M.post("./sales",t).then(o=>{var i;o.data.dinner&&(F.value=o.data.dinner,C.value=o.data.dinner.subdealership,n("success",o.data.message||"Venta registrada exitosamente."),(i=p.value)==null||i.cleanInput(),d.value=o.data.sales||[]),o.data.otherCafe&&(console.log(m.value),g())}).catch(o=>{var i;console.error("Error fetching dinners:",o),n("error",o),(i=p.value)==null||i.cleanInput()})};return(e,t)=>(x(),J(L,null,[s(A(j),{title:"Comensales"}),s(T,null,{default:z(()=>[s(W,{showAlert:_.value,type:y.value,description:S.value},null,8,["showAlert","type","description"]),f("div",te,[t[0]||(t[0]=f("h2",{class:"text-center text-2xl font-semibold"},"Punto de Venta",-1)),A(I).find(o=>o.id==14)?(x(),G(Q,{key:0,dealerships:e.dealerships},null,8,["dealerships"])):K("",!0),s(Z,{cafes:e.cafes,subdealerships:e.subdealerships,services:e.services,receipt_types:e.receipt_types,sale_types:e.sale_types,onShowServicesFromCafeSelected:$,onUpdateDate:B,onUpdateFormData:O,onAddServiceSelected:P},null,8,["cafes","subdealerships","services","receipt_types","sale_types"]),f("div",ae,[s(Y,{dinnerFound:F.value,subdealership:C.value,onHandleShowAlert:n,onShowDialog:g,onSaveSale:v,onUpdateDni:H,ref_key:"salesCardRef",ref:p},null,8,["dinnerFound","subdealership"]),s(ee,{sales:d.value,paginateData:h.todaySales},null,8,["sales","paginateData"]),s(X,{showOtherUnitDialog:c.value,onHideDialog:V,onHandleDoublePriceSave:q},null,8,["showOtherUnitDialog"])])])]),_:1})],64))}});export{lt as default};
