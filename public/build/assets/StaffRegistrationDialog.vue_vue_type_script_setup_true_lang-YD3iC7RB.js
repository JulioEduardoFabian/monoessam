import{_ as y}from"./index-BriVRbJO.js";import{_ as P,a as R,b as V,c as z}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CzVsIQJi.js";import{_ as M}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BVI35HHn.js";import{_ as O}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DhSgUwMc.js";import{_ as L}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-32pCUGwc.js";import{c as G,_ as Z,a as F,b as w}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DNpA3n5S.js";import{_ as W}from"./AlertErrors.vue_vue_type_script_setup_true_lang-CVvBO9c6.js";import{j as m,C as X,d as H,g as I,o as D,w as s,a as t,u as e,e as p,b as S,i as J}from"./app-DO1fLEsg.js";import{_ as K}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-CTFtZ6zn.js";import{_ as Q}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-q3Dq8GaC.js";import{_ as Y}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-DP-RzTZD.js";import{_ as q}from"./SizesTab.vue_vue_type_script_setup_true_lang-oEFt9wZ1.js";const ee=9*1024*1024;function ae(){const n=m(!1),u=m(""),o=m([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:o,showAlert:n,alertMessage:u,handleFileUpload:(x,d,f)=>{const r=x.target.files;if(r.length>0){const i=r[0];if(i.size>ee)u.value="El archivo es demasiado grande. El máximo es 9MB.",n.value=!0;else{const c=o.value.find(l=>l.label==d);if(c){const _=i.name.split(".").pop(),b=new File([i],`${d}_${Date.now()}.${_}`,{type:i.type});f.push({file:b,label:d}),c.file=b}}}},handleDateFile:(x,d)=>{o.value[d].expirationDate=x}}}function le(){const n=m(null),u=m(null),o=m(null);return{fileInput:n,imagePreview:u,selectedFile:o,triggerFileInput:()=>{var d;(d=n.value)==null||d.click()},handleImageUpload:d=>{var i;const r=(i=d.target.files)==null?void 0:i[0];if(r){if(!r.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const c=5*1024*1024;if(r.size>c){alert("La imagen es demasiado grande. Máximo 5MB");return}o.value=r;const l=new FileReader;l.onload=_=>{var b;u.value=(b=_.target)==null?void 0:b.result},l.readAsDataURL(r)}},removeImage:()=>{u.value=null,o.value=null,n.value&&(n.value.value="")}}}function te(){const n=X({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",fechaIngreso:"",fechaFinContract:"",cc:"",cci:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[]}),u=m([]),o=m(!1),g=m([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]);return{form:n,errorsSend:u,showErrors:o,prendasFijas:g,handleSubmit:(f,r)=>{let i;Array.isArray(r)?i=r:r&&typeof r=="object"?i=Array.isArray(r.value)?r.value:Object.values(r):i=[],i.forEach(l=>{l&&l.expirationDate===null?n.filesData.push({expirationDate:"-"}):n.filesData.push({expirationDate:l.expirationDate})}),console.log("filesArray:",i);const c=i.filter(l=>l&&typeof l=="object").map(l=>l.file).filter(l=>l instanceof File);if(console.log("Archivos válidos a subir:",c.length,c),c.length===0){console.error("No hay archivos válidos para subir"),o.value=!0,u.value={files:["No hay archivos seleccionados"]};return}n.prendas=g.value,n.files=c,n.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:l=>{n.reset(),f()},onError:l=>{o.value=!0,u.value=l,console.error("Error al subir el archivo:",l)}})},selectCafe:f=>{n.cafeId=f.id,n.unitId=f.unit_id,n.unitSelectedText=f.unit.name},selectRole:f=>{n.roleId=f.id}}}const oe={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},be=H({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{}},setup(n){const u=m(!1),o=m("personal"),{form:g,errorsSend:C,showErrors:x,prendasFijas:d,handleSubmit:f,selectCafe:r,selectRole:i}=te(),{fileInput:c,imagePreview:l,triggerFileInput:_,handleImageUpload:b,removeImage:A}=le(),{filesRequired:U,showAlert:j,alertMessage:E,handleFileUpload:$,handleDateFile:k}=ae(),T=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a<v.length-1&&(o.value=v[a+1])},N=()=>{const v=["personal","adjuntos","financiero","tallas"],a=v.indexOf(o.value);a>0&&(o.value=v[a-1])},B=()=>{f(()=>{u.value=!1,o.value="personal"},U)};return(v,a)=>(D(),I(e(z),{open:u.value,"onUpdate:open":a[2]||(a[2]=h=>u.value=h)},{default:s(()=>[t(e(L),{"as-child":""},{default:s(()=>[t(e(y),{variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[3]||(a[3]=[p(" Nuevo Personal ")])),_:1})]),_:1}),t(e(P),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:s(()=>[S("input",{type:"file",ref_key:"fileInput",ref:c,onChange:a[0]||(a[0]=(...h)=>e(b)&&e(b)(...h)),accept:"image/*",class:"hidden"},null,544),t(e(R),{class:"z-10 border-b bg-white px-6 py-4"},{default:s(()=>[t(e(V),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:s(()=>a[4]||(a[4]=[p(" Ficha de Registro de Colaborador ")])),_:1}),t(e(M),null,{default:s(()=>a[5]||(a[5]=[p(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),t(W,{show:e(x),errors:e(C)},null,8,["show","errors"])]),_:1}),S("div",oe,[t(e(G),{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=h=>o.value=h),class:"w-full"},{default:s(()=>[t(e(Z),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:s(()=>[t(e(F),{value:"personal",class:"text-xs md:text-sm"},{default:s(()=>a[6]||(a[6]=[p("1. Personal")])),_:1}),t(e(F),{value:"adjuntos",class:"text-xs md:text-sm"},{default:s(()=>a[7]||(a[7]=[p("2. Adjuntos")])),_:1}),t(e(F),{value:"financiero",class:"text-xs md:text-sm"},{default:s(()=>a[8]||(a[8]=[p("3. Financiero")])),_:1}),t(e(F),{value:"tallas",class:"text-xs md:text-sm"},{default:s(()=>a[9]||(a[9]=[p("4. Tallas")])),_:1})]),_:1}),t(e(w),{value:"personal",class:"mt-0"},{default:s(()=>[t(Y,{form:e(g),cafes:v.cafes,"image-preview":e(l),onTriggerUpload:e(_),onRemoveImage:e(A),onSelectCafe:e(r)},null,8,["form","cafes","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe"])]),_:1}),t(e(w),{value:"adjuntos",class:"mt-0"},{default:s(()=>[t(K,{"files-required":e(U),"show-alert":e(j),"alert-message":e(E),form:e(g),onUploadFile:e($),onUploadDate:e(k)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),t(e(w),{value:"financiero",class:"mt-0"},{default:s(()=>[t(Q,{form:e(g),roles:v.roles,onSelectRole:e(i),onUploadFile:e($)},null,8,["form","roles","onSelectRole","onUploadFile"])]),_:1}),t(e(w),{value:"tallas",class:"mt-0"},{default:s(()=>[t(q,{prendas:e(d)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),t(e(O),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:s(()=>[S("div",null,[o.value!=="personal"?(D(),I(e(y),{key:0,onClick:N,variant:"outline",type:"button"},{default:s(()=>a[10]||(a[10]=[p(" ← Anterior ")])),_:1})):J("",!0)]),S("div",null,[o.value!=="tallas"?(D(),I(e(y),{key:0,onClick:T,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:s(()=>a[11]||(a[11]=[p(" Siguiente → ")])),_:1})):(D(),I(e(y),{key:1,onClick:B,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:s(()=>a[12]||(a[12]=[p(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{be as _};
