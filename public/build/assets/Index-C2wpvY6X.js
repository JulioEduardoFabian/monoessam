import{_ as $}from"./index-B6gHrJNg.js";import{_ as S,a as U,b,c as G,d as V}from"./SelectValue.vue_vue_type_script_setup_true_lang-BSDoXptP.js";import{_ as D,a as C}from"./SelectLabel.vue_vue_type_script_setup_true_lang-BM6ObKl0.js";import{_ as P}from"./AppLayout.vue_vue_type_script_setup_true_lang-MctjZMeD.js";import{d as T,j as m,s as H,v as O,c,o as u,a,u as t,m as J,w as o,b as i,e as f,F as v,p as _,g as M,t as A}from"./app-wpK-6FY7.js";import K from"./GuardAreaDroppable-DgqBRt1R.js";import{_ as Q}from"./GuardModal.vue_vue_type_script_setup_true_lang-BPOB4ffM.js";import{_ as W}from"./StaffSelectables.vue_vue_type_script_setup_true_lang-B75L2a4d.js";import{_ as X}from"./TableHeadcount.vue_vue_type_script_setup_true_lang-i1G2eCUJ.js";import{c as Y}from"./createLucideIcon-hLawIQYr.js";import"./Primitive-BT2gVRBs.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-D4e4Z6df.js";import"./useForwardExpose-QX88rGgF.js";import"./Teleport-DnngySgB.js";import"./chevron-down-DUmZJ6r8.js";import"./Collection-BcPbUVDO.js";import"./usePrimitiveElement-DHpav3qp.js";import"./check-tdWq_Fx3.js";import"./PopperContent-DYXHcn6v.js";import"./useTypeahead-MawKHJDc.js";import"./utils-_Eec-yyG.js";import"./VisuallyHidden-CAHDlTUI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CWGTB5dl.js";import"./RovingFocusGroup-CsdKLqS9.js";import"./DialogTitle-BcX40DJK.js";import"./x-DEz-tHsO.js";import"./DialogDescription-DuRgTTzH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./hand-helping-C22uE6Q9.js";import"./building-2-CLwYIURL.js";import"./user-DE-iMXxw.js";import"./chevron-right-BuJK7LeQ.js";import"./GuardRolesDropzone-xiQ01RiV.js";import"./Draggable-Cz6lHeWv.js";import"./GuardRolesModal-aUNUHzLd.js";import"./index-BWUsgq1x.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-CyFUbLGS.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-BrTBw2t3.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-BrIkRU5G.js";import"./Input.vue_vue_type_script_setup_true_lang-PJeZxqx7.js";import"./plus-DdAojqpy.js";import"./circle-alert-BCIbkmpx.js";import"./trash-B-WrQTN2.js";import"./Label.vue_vue_type_script_setup_true_lang-De5X2p6I.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-B-glDTPF.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=Y("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ee={class:"flex h-full flex-1 flex-col gap-6 p-6"},se={class:"flex w-full flex-row"},ae={class:"flex gap-2"},le=["hidden"],te={key:0,class:"grid h-full auto-rows-fr gap-6 md:grid-cols-8"},oe={class:"md:col-span-6"},ie={class:"flex h-full gap-6"},ne={key:1,class:"flex h-full items-center justify-center p-10 text-center"},re=["hidden"],ue={class:"grid h-full"},ls=T({__name:"Index",props:{users:{},roles:{},permissions:{},areas:{},headquarters:{},mines:{},units:{}},setup(I){const h=I,n=m({mine:null,unit:null,cafe:null}),x=m([]),y=m([]),z=m([]),d=m([]),g=m(!1),p=m([]),k=m([]);H(n,l=>{if(l.mine!==null&&l.mine!==void 0){const e=h.mines.find(s=>String(s.id)===String(l.mine));x.value=e?e.units:[]}if(l.unit){const e=x.value.find(s=>s.id==l.unit);y.value=e?e.cafes:[]}l.cafe&&w(Number(l.cafe))},{deep:!0});const w=async l=>{try{const s=(await O.get(`/cafes/${l}`)).data;d.value=s.guards,p.value=s.users.unassigned,k.value=s.users.assigned,z.value=s.periods}catch(e){console.error("Error fetching cafe data:",e)}},L=l=>{p.value=p.value.filter(e=>e.id!==l),w(n.value.cafe)},R=l=>{console.log("updating guards",l),d.value=l},j=(l,e)=>{const s=d.value.find(r=>r.id===l);s&&(s.assigned_roles=[],e.forEach(r=>{const F={role:{id:r.id,guard_id:l,role_id:r.id,name:r.name}};s.assigned_roles.push(F)}))},B=(l,e)=>{const s=d.value.find(r=>r.id===l);console.log(e),s&&(s.assigned_roles=s.assigned_roles.filter(r=>r.id!==e))},N=l=>{d.value=d.value.filter(e=>e.id!==l)},q=l=>{if(y.value.find(s=>s.id==n.value.cafe)){const s=h.users.find(r=>r.id===l);s&&p.value.unshift(s)}},E=()=>{g.value=!g.value};return(l,e)=>(u(),c(v,null,[a(t(J),{title:"Headcount"}),a(P,null,{default:o(()=>[i("div",ee,[e[10]||(e[10]=i("div",{class:"flex"},[i("h1",{class:"text-2xl font-bold"},"Puestos")],-1)),e[11]||(e[11]=i("p",null,"Seleccione una mina, unidad y comedor para asignar guardias y roles",-1)),i("div",se,[a($,{title:"Ver en lista",class:"cursor-pointer",onClick:e[0]||(e[0]=s=>E())},{default:o(()=>[a(t(Z))]),_:1})]),i("div",ae,[a(t(S),{class:"w-full",modelValue:n.value.mine,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.mine=s)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona una mina"})]),_:1}),a(t(G),null,{default:o(()=>[a(t(D),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[4]||(e[4]=[f("Minas")])),_:1}),(u(!0),c(v,null,_(h.mines,s=>(u(),M(t(V),{value:String(s.id),key:s.id},{default:o(()=>[f(A(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(S),{class:"w-full",modelValue:n.value.unit,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.unit=s)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona una unidad minera"})]),_:1}),a(t(G),null,{default:o(()=>[a(t(D),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[5]||(e[5]=[f("Unidades mineras")])),_:1}),(u(!0),c(v,null,_(x.value,s=>(u(),M(t(V),{value:s.id,key:s.id},{default:o(()=>[f(A(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(t(S),{class:"w-full",modelValue:n.value.cafe,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.cafe=s)},{default:o(()=>[a(t(U),{class:"w-full"},{default:o(()=>[a(t(b),{placeholder:"Selecciona un comedor"})]),_:1}),a(t(G),null,{default:o(()=>[a(t(D),null,{default:o(()=>[a(t(C),null,{default:o(()=>e[6]||(e[6]=[f("Comedores")])),_:1}),(u(!0),c(v,null,_(y.value,s=>(u(),M(t(V),{value:s.id,key:s.id},{default:o(()=>[f(A(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Q,{cafeId:n.value.cafe,onAssignGuards:R},null,8,["cafeId"]),a($,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>e[7]||(e[7]=[f(" Agregar roles ")])),_:1}),a($,{class:"h-full w-auto bg-green-500 text-white hover:bg-green-600"},{default:o(()=>e[8]||(e[8]=[f(" Agregar puesto ")])),_:1})]),i("div",{class:"h-full",hidden:g.value},[d.value&&d.value.length>0?(u(),c("div",te,[a(W,{users:p.value,class:"md:col-span-2"},null,8,["users"]),i("div",oe,[(u(!0),c(v,null,_(d.value,s=>(u(),c("div",{class:"overflow-x-auto",key:s.id},[i("div",ie,[a(K,{users:k.value,roles:l.roles,guard:s,onDropped:L,onAsignRolesToGuard:j,onDeleteGuardRole:B,onDeleteGuard:N,onUnassignUser:q,unassignedUsers:p.value},null,8,["users","roles","guard","unassignedUsers"])])]))),128))])])):(u(),c("div",ne,e[9]||(e[9]=[i("p",{class:"text-xl font-semibold text-gray-500"},[f(" ⚠️ Por favor seleccione un comedor y asigne guardias para continuar. "),i("br"),f(" (La lista de guardias aparecerá aquí una vez se asignen). ")],-1)])))],8,le),i("div",{class:"h-full",hidden:!g.value},[i("div",ue,[a(X,{guards:d.value,users:k.value,cafeId:n.value.cafe,periods:z.value,onFetchCafeData:w},null,8,["guards","users","cafeId","periods"])])],8,re)])]),_:1})],64))}});export{ls as default};
