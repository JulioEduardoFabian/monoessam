import{_ as F}from"./index-Cc3Ui_bo.js";import{_ as le,a as se,b as ne,c as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-4wfZ2Drx.js";import{_ as ie}from"./DialogDescription.vue_vue_type_script_setup_true_lang-B6tzs8z5.js";import{_ as re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BQduKEbA.js";import{_ as fe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DUd2ljrV.js";import{c as ce,_ as ue,a as I,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-Dbw0ojZL.js";import{_ as de}from"./AlertErrors.vue_vue_type_script_setup_true_lang-B6Ghg8av.js";import{j as v,C as me,d as pe,g as w,o as C,w as n,a as o,u as e,e as _,b as $,i as ve}from"./app-O7M5E6Ts.js";import{_ as be}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-CJYQZLRa.js";import{_ as ge}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-CynMMxtZ.js";import{_ as _e}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CtcLqR1v.js";import{_ as xe}from"./SizesTab.vue_vue_type_script_setup_true_lang-DR1-Wl4f.js";import{P as Se}from"./pencil-DUe7k8iU.js";const ye=9*1024*1024;function he(){const s=v(!1),a=v(""),f=v([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:f,showAlert:s,alertMessage:a,handleFileUpload:(x,p,h)=>{const b=x.target.files;if(b.length>0){const g=b[0];if(g.size>ye)a.value="El archivo es demasiado grande. El máximo es 9MB.",s.value=!0;else{const S=f.value.find(i=>i.label==p);if(S){const u=g.name.split(".").pop(),r=new File([g],`${p}_${Date.now()}.${u}`,{type:g.type});h.push({file:r,label:p}),S.file=r}}}},handleDateFile:(x,p)=>{f.value[p].expirationDate=x}}}function we(){const s=v(null),a=v(null),f=v(null);return{fileInput:s,imagePreview:a,selectedFile:f,triggerFileInput:()=>{var p;(p=s.value)==null||p.click()},handleImageUpload:p=>{var g;const b=(g=p.target.files)==null?void 0:g[0];if(b){if(!b.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const S=5*1024*1024;if(b.size>S){alert("La imagen es demasiado grande. Máximo 5MB");return}f.value=b;const i=new FileReader;i.onload=u=>{var r;a.value=(r=u.target)==null?void 0:r.result},i.readAsDataURL(b)}},removeImage:()=>{a.value=null,f.value=null,s.value&&(s.value.value="")}}}function Ce(){const s=me({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:"",pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),a=v([]),f=v(!1),c=v([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),t=v([]);return{form:s,errorsSend:a,showErrors:f,prendasFijas:c,cafesUnitSelected:t,handleSubmit:(i,u)=>{let r;Array.isArray(u)?r=u:u&&typeof u=="object"?r=Array.isArray(u.value)?u.value:Object.values(u):r=[],r.forEach(d=>{d&&d.expirationDate===null?s.filesData.push({expirationDate:"-"}):s.filesData.push({expirationDate:d.expirationDate})}),console.log("filesArray:",r);const D=r.filter(d=>d&&typeof d=="object").map(d=>d.file).filter(d=>d instanceof File);console.log("Archivos válidos a subir:",D.length,D),s.prendas=c.value,s.files=D,s.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:d=>{s.reset(),i()},onError:d=>{f.value=!0,a.value=d,console.error("Error al subir el archivo:",d)}})},updateStaff:(i,u)=>{s.prendas=c.value,s.put(route("staff.update",u),{onSuccess:r=>{s.reset(),i()},onError:r=>{f.value=!0,a.value=r,console.error("Error al subir el archivo:",r)}})},selectCafe:i=>{s.cafeId=i.id},selectRole:i=>{s.roleId=i.id},selectUnit:i=>{s.unitId=i.id,t.value=i.cafes,s.unitSelectedText=i.name},selectArea:i=>{s.areaId=i}}}const De={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ve=pe({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(s){var j,P,R,T,z,B,V,M,N,O,L,G,Z,W,X;const a=s,f=v(!1),c=v("personal"),{form:t,errorsSend:x,showErrors:p,prendasFijas:h,cafesUnitSelected:b,handleSubmit:g,updateStaff:S,selectCafe:i,selectRole:u,selectUnit:r,selectArea:D}=Ce();a.staff&&(console.log(a.staff),t.name=a.staff.name,t.dni=a.staff.dni,t.cell=a.staff.cell,t.birthdate=String(a.staff.birthdate),t.age=a.staff.age,t.sex=String(a.staff.sex),t.email=a.staff.email,t.country=a.staff.country,t.civilstatus=String(a.staff.civilstatus),t.contactname=a.staff.contactname,t.contactcell=a.staff.contactcell,t.district=(j=a.staff.staff_financial)==null?void 0:j.district,t.province=(P=a.staff.staff_financial)==null?void 0:P.province,t.department=(R=a.staff.staff_financial)==null?void 0:R.department,t.address=(T=a.staff.staff_financial)==null?void 0:T.address,t.workSystem=(z=a.staff.staff_financial)==null?void 0:z.system_work,t.replacement=(B=a.staff.staff_financial)==null?void 0:B.replacement,t.salary=(V=a.staff.staff_financial)==null?void 0:V.salary,t.observations=(M=a.staff.staff_financial)==null?void 0:M.observations,t.bankEntity=String((N=a.staff.staff_financial)==null?void 0:N.bank_entity),t.cc=(O=a.staff.staff_financial)==null?void 0:O.account_number,t.cci=(L=a.staff.staff_financial)==null?void 0:L.cci,t.pensioncontribution=String((G=a.staff.staff_financial)==null?void 0:G.pensioncontribution),t.startDate=String((Z=a.staff.staff_financial)==null?void 0:Z.start_date),t.contractEndDate=String((W=a.staff.staff_financial)==null?void 0:W.contract_end_date),t.children=(X=a.staff.staff_financial)==null?void 0:X.children,a.staff.staff_clothes.forEach(m=>{const l=h.value.find(y=>y.label==m.clothe_name);l.talla=m.clothing_size}));const{fileInput:d,imagePreview:H,triggerFileInput:J,handleImageUpload:A,removeImage:K}=we(),{filesRequired:E,showAlert:Q,alertMessage:Y,handleFileUpload:k,handleDateFile:q}=he(),ee=()=>{const m=["personal","adjuntos","financiero","tallas"],l=m.indexOf(c.value);l<m.length-1&&(c.value=m[l+1])},ae=()=>{const m=["personal","adjuntos","financiero","tallas"],l=m.indexOf(c.value);l>0&&(c.value=m[l-1])},te=()=>{a.staff?S(()=>{f.value=!1,c.value="personal"},a.staff.id):g(()=>{f.value=!1,c.value="personal"},E)};return(m,l)=>(C(),w(e(oe),{open:f.value,"onUpdate:open":l[2]||(l[2]=y=>f.value=y)},{default:n(()=>[o(e(fe),{"as-child":""},{default:n(()=>[a.staff?(C(),w(e(F),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:n(()=>[o(e(Se))]),_:1})):(C(),w(e(F),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>l[3]||(l[3]=[_(" Nuevo Personal ")])),_:1}))]),_:1}),o(e(le),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:n(()=>[$("input",{type:"file",ref_key:"fileInput",ref:d,onChange:l[0]||(l[0]=(...y)=>e(A)&&e(A)(...y)),accept:"image/*",class:"hidden"},null,544),o(e(se),{class:"z-10 border-b bg-white px-6 py-4"},{default:n(()=>[o(e(ne),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:n(()=>l[4]||(l[4]=[_(" Ficha de Registro de Colaborador ")])),_:1}),o(e(ie),null,{default:n(()=>l[5]||(l[5]=[_(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),o(de,{show:e(p),errors:e(x)},null,8,["show","errors"])]),_:1}),$("div",De,[o(e(ce),{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=y=>c.value=y),class:"w-full"},{default:n(()=>[o(e(ue),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:n(()=>[o(e(I),{value:"personal",class:"text-xs md:text-sm"},{default:n(()=>l[6]||(l[6]=[_("1. Personal")])),_:1}),o(e(I),{value:"adjuntos",class:"text-xs md:text-sm"},{default:n(()=>l[7]||(l[7]=[_("2. Adjuntos")])),_:1}),o(e(I),{value:"financiero",class:"text-xs md:text-sm"},{default:n(()=>l[8]||(l[8]=[_("3. Financiero")])),_:1}),o(e(I),{value:"tallas",class:"text-xs md:text-sm"},{default:n(()=>l[9]||(l[9]=[_("4. Tallas")])),_:1})]),_:1}),o(e(U),{value:"personal",class:"mt-0"},{default:n(()=>[o(_e,{staff:m.staff,form:e(t),cafes:e(b),units:m.units,roles:m.roles,businneses:m.businneses,"image-preview":e(H),onTriggerUpload:e(J),onRemoveImage:e(K),onSelectCafe:e(i),onSelectUnit:e(r),onSelectRole:e(u),onSelectArea:e(D)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),o(e(U),{value:"adjuntos",class:"mt-0"},{default:n(()=>[o(be,{"files-required":e(E),"show-alert":e(Q),"alert-message":e(Y),form:e(t),onUploadFile:e(k),onUploadDate:e(q)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),o(e(U),{value:"financiero",class:"mt-0"},{default:n(()=>[o(ge,{form:e(t),roles:m.roles,onSelectRole:e(u),onUploadFile:e(k)},null,8,["form","roles","onSelectRole","onUploadFile"])]),_:1}),o(e(U),{value:"tallas",class:"mt-0"},{default:n(()=>[o(xe,{prendas:e(h)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),o(e(re),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:n(()=>[$("div",null,[c.value!=="personal"?(C(),w(e(F),{key:0,onClick:ae,variant:"outline",type:"button"},{default:n(()=>l[10]||(l[10]=[_(" ← Anterior ")])),_:1})):ve("",!0)]),$("div",null,[c.value!=="tallas"?(C(),w(e(F),{key:0,onClick:ee,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>l[11]||(l[11]=[_(" Siguiente → ")])),_:1})):(C(),w(e(F),{key:1,onClick:te,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:n(()=>l[12]||(l[12]=[_(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ve as _};
